<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>考勤管理系统</title>
    <script src="xlsx.full.min.js"></script>
    <link rel="stylesheet" href="fontawesome-free-7.1.0-web/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f9fafb;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            color: #1f2937;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background-color: #ffffff;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        header nav {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0.75rem 1rem;
        }

        header nav ul {
            display: flex;
            flex-wrap: wrap;
            margin: 0;
            padding: 0;
            list-style: none;
            gap: 1rem;
        }

        .relative-group {
            position: relative;
            list-style: none;
        }

        .page-section {
            width: 100% !important;
            min-width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box;
            display: none;
        }

        .page-section.block {
            display: block;
        }

        .page-section.hidden {
            display: none;
        }

        .nav-link {
            padding: 0.75rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #718096;
            text-decoration: none;
            box-sizing: border-box;
            display: inline-block;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }

        .nav-link:hover {
            color: #165DFF;
            background-color: #f9fafb;
        }

        .nav-link.active {
            color: #165DFF;
            border-bottom: 0.3rem solid #165DFF;
        }

        .relative-group > div {
            position: absolute;
            left: 0;
            top: 100%;
            margin-top: 0.25rem;
            width: 12rem;
            background-color: #ffffff;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 0.5rem 0;
            z-index: 100;
            display: none;
        }

        .dean-link {
            display: block;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            color: #4a5568;
            text-decoration: none;
            transition: background-color 0.2s ease;
        }

        .dean-link:hover,
        .dean-link.active {
            background-color: #f7fafc;
            color: #165DFF;
        }

        .relative-group:hover > div,
        .relative-group:focus-within,
        .relative-group.active > div {
            display: block;
        }

        .relative-group:hover i {
            transform: rotate(180deg);
            font-weight: 900;
        }

        main {
            flex-grow: 1;
            padding: 1.5rem 1rem;
            min-width: 1280px;
            margin: 0 auto;
        }

        .container {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            padding:1rem 1.5rem;
            margin-bottom: 1.5rem;
        }

        .title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        .title i {
            color: #165DFF;
            margin-right: 0.5rem;
        }

        .drop-area {
            border: 1px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .drop-area:hover {
            border-color: #165DFF;
        }

        .drop-area i {
            font-size: 4rem;
            color: #9ca3af;
            margin-bottom: 0.75rem;
        }

        .drop-area p:first-of-type {
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .drop-area p:last-of-type {
            color: #9ca3af;
            font-size: 0.875rem;
        }

        .file-input {
            display: none;
        }

        .select-file-btn {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background-color: #165DFF;
            color: #ffffff;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 0.875rem;
        }

        .select-file-btn:hover {
            background-color: rgba(22, 93, 255, 0.9);
        }

        .file-info {
            margin-top: 1rem;
            display: none;
        }

        .file-info-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background-color: #f9fafb;
            border-radius: 0.375rem;
        }

        .file-info-left {
            display: flex;
            align-items: center;
        }

        .file-info-left i {
            color: #165DFF;
            margin-right: 0.5rem;
        }

        .file-name {
            color: #374151;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            overflow: hidden;
            max-width: 28rem;
            font-size: 0.875rem;
        }

        .remove-file-btn {
            color: #F53F3F;
            background: none;
            border: none;
            cursor: pointer;
            transition: color 0.2s ease;
            font-size: 0.875rem;
        }

        .remove-file-btn:hover {
            color: rgba(245, 63, 63, 0.8);
        }

        .upload-confirm-wrap {
            margin-top: 1.5rem;
            display: flex;
            justify-content: flex-end;
        }

        .upload-confirm-btn {
            padding: 0.5rem 1.5rem;
            background-color: #165DFF;
            color: #ffffff;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }

        .upload-confirm-btn:hover {
            background-color: rgba(22, 93, 255, 0.9);
        }

        .upload-confirm-btn i {
            margin-right: 0.5rem;
        }

        .staff-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            box-sizing: border-box;
        }

        .from-group {
            box-sizing: border-box;
        }

        .staff {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #4b5563;
            margin-bottom: 4px;
        }

        .warring {
            color: #F53F3F;
            font-size: 15px;
        }

        .staff-input {
            width: 100%;
            height: 38px;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            box-sizing: border-box;
            outline: none;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .staff-input:focus {
            border-color: #165DFF;
            box-shadow: 0 0 0 2px rgba(22, 93, 255, 0.3);
        }

        .staff-submit {
            width: 100%;
            margin-top: 25px;
            padding: 9px 24px;
            background-color: #165DFF;
            color: #ffffff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .staff-submit:hover {
            background-color: #165cffbd;
        }

        .staff-header {
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }

        .staff-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }

        .staff-title i {
            color: #165DFF;
            margin-right: 0.5rem;
        }

        .header-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .search-wrapper {
            position: relative;
            width: 100%;
        }

        .search-input,
        .dean-search {
            padding-left: 2.5rem;
            padding-right: 1rem;
            padding-top: 0.55rem;
            padding-bottom: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            outline: none;
            transition: all 0.2s ease;
            width: 100%;
            font-size: 0.875rem;
            box-sizing: border-box;
        }

        .search-input:focus,
        .dean-search:focus {
            outline: 2px solid rgba(22, 93, 255, 0.5);
            outline-offset: 0;
            border-color: #165DFF;
            box-shadow: 0 0 0 2px rgba(22, 93, 255, 0.3);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 0.875rem;
        }

        .batch-upload-label {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #374151;
            font-size: 0.875rem;
        }

        .batch-upload-label:hover {
            background-color: #f9fafb;
        }

        .batch-upload-label .text-primary {
            color: #165DFF;
            margin-right: 0.5rem;
        }

        .batch-upload-input {
            display: none;
        }

        .clear-all-btn ,
        .delete-month-btn{
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: #ee2e2e;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }

        .hidden {
            display: none;
        }

        .clear-all-btn i,
        .delete-month-btn i {
            margin-right: 0.5rem;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .clear-all-btn:hover,
        .delete-month-btn:hover {
            background-color: #ee2e2ed0;
        }

        .export-btn,
        .dean-export {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            background-color: #165DFF;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            font-size: 0.875rem;
            gap: 7px;
        }

        .export-btn:hover,
        .dean-export:hover {
            background-color: #165cffb0;
        }

        .export-btn i,
        .dean-export i {
            font-size: 1rem;
            margin-top: 2.5px;
        }

        .table-container {
            width: 100%;
            scrollbar-width: thin;
            max-height: 50vh;
            overflow: auto;
        }

        .attendance-show .table-container,
        .data-arrange .table-container,
        .dean-page .table-container {
            max-height: 70vh;
        }

        .staff-table{
            min-width: 100%;
        }
        
        .attendance-table {
            min-width: 170%;
        }

        .arrange-table {
            min-width: 150%;
        }

        .staff-table th,
        .attendance-table th,
        .arrange-table th {
            background-color: #f9fafb;
            text-align: left;
            padding: 0.75rem;
            font-size: 16px;
            font-weight: 700;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            border-radius: 2px;
        }

        .table-header-row th:nth-child(1),
        .table-header-row th:nth-child(4),
        .table-header-row th:nth-child(5),
        .table-header-row th:nth-child(2),
        .table-header-row th:nth-child(3) {
            width: 15%;
        }
        
        .staff-table td,
        .attendance-table td,
        .arrange-table td {
            background-color: white;
            text-align: left;
            padding: 0.75rem;
            font-size: 16px;
            font-weight: 500;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }

        .empty-cell,
        .attendance-empty-cell,
        .arrange-empty-cell {
            padding: 2rem 1rem;
            color: #6b7280;
            border-bottom: none !important;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 16px;
            max-width: 320px;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            background-color: #ffffff;
            box-sizing: border-box;
        }

        .edit-staff-modal,
        .edit-attendance-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }

        .edit-staff-modal.show,
        .edit-attendance-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .edit-staff-modal .modal-content {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            width: 90%;
            max-width: 446px;
            box-sizing: border-box;
            transform: translateY(-1rem);
            transition: transform 0.2s ease;
        }

        .edit-attendance-modal .modal-content {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            width: 90%;
            max-width: 670px;
            box-sizing: border-box;
            transform: translateY(-1rem);
            transition: transform 0.2s ease;
        }

        .edit-staff-modal.show .modal-content,
        .edit-attendance-modal.show .modal-content {
            transform: translateY(0);
        }

        .edit-staff-modal .modal-header,
        .edit-attendance-modal .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .edit-staff-modal .modal-title,
        .edit-attendance-modal .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }

        .edit-staff-modal .close-edit-modal,
        .edit-attendance-modal .close-attendance-modal {
            color: #171717;
            cursor: pointer;
            transition: color 0.2s ease;
            font-size: 1rem;
            border-style: none;
            background-color: transparent;
            padding: 5px 3px;
        }

        .edit-staff-modal .close-edit-modal:hover,
        .edit-attendance-modal .close-attendance-modal:hover {
            color: #ffffff;
            background-color: #860303;
        }

        .edit-staff-form,
        .edit-attendance-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            box-sizing: border-box;
        }

        .edit-staff-form .form-group,
        .edit-attendance-form .form-group {
            box-sizing: border-box;
        }

        .edit-attendance-form .time-group {
            grid-column: 1 / -1;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: nowrap;
        }

        .edit-attendance-form .time-group input[type="time"] {
        flex: 1;
        min-width: 120px;
        padding: 0.5rem;
        border: 1px solid #d1d5db;  
        border-radius: 0.375rem;
        outline: none;
        box-sizing: border-box;
        font-size: 16px;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        color: #374151;
        width: auto;
        }

        .edit-attendance-form .time-group input[type="time"]:focus {
            border-color: #165DFF;
            box-shadow: 0 0 0 2px rgba(22, 93, 255, 0.3);
            outline: none;
        }

        .edit-staff-form input[type="text"],
        .edit-staff-form select,
        .edit-attendance-form input[type="text"],
        .edit-staff-form .form-group label,
        .edit-attendance-form .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .edit-staff-form .form-group label .warring,
        .edit-attendance-form .form-group label .warring {
            color: #F53F3F;
        }

        .edit-staff-form input[type="text"],
        .edit-staff-form select,
        .edit-attendance-form input[type="text"],
        .edit-attendance-form input[type="date"],
        .edit-attendance-form select {
            width: 100%;
            padding: 0.75rem 0.75rem; 
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            outline: none;
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            color: #374151;
        }

        .edit-staff-form input[type="text"]:focus,
        .edit-staff-form select:focus,
        .edit-attendance-form input[type="text"]:focus,
        .edit-attendance-form input[type="date"]:focus,
        .edit-attendance-form select:focus {
            border-color: #165DFF;
            box-shadow: 0 0 0 2px rgba(22, 93, 255, 0.3);
            outline: none;
        }

        input[readonly] {
            background-color: #f9fafb;
            cursor: not-allowed;
        }

        .edit-staff-form .form-group.btn-group,
        .edit-attendance-form .form-group.btn-group {
            width: 100%;
            display: flex;
            gap: 0.75rem;
            margin-top: 2px;
        }

        .edit-attendance-form .form-group.btn-group {
            grid-column: 2 / -1;
        }

        .edit-staff-form .cancel-edit,
        .edit-attendance-form .cancel-attendance-edit {
            flex: 1;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            color: #374151;
            background-color: #ffffff;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background-color 0.2s ease;
        }

        .edit-staff-form .cancel-edit:hover,
        .edit-attendance-form .cancel-attendance-edit:hover {
            background-color: #f9fafb;
        }

        .edit-staff-form button[type="submit"],
        .edit-attendance-form button[type="submit"] {
            flex: 1;
            padding: 12px 16px;
            background-color: #165DFF;
            color: #ffffff;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background-color 0.2s ease;
        }

        .edit-staff-form button[type="submit"]:hover,
        .edit-attendance-form button[type="submit"]:hover {
            background-color: rgba(22, 93, 255, 0.9);
        }

        .edit-staff-id {
            display: none;
        }

        .month-filter-input,
        .dean-month-filter {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            outline: none;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            box-sizing: border-box;
        }

        .month-filter-input:focus,
        .dean-month-filter:focus {
            outline: 2px solid rgba(22, 93, 255, 0.5);
            outline-offset: 0;
            border-color: #165DFF;
            box-shadow: 0 0 0 2px rgba(22, 93, 255, 0.3);
        }

        .attendance-add-blank-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            background-color: #F59E0B;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            font-size: 0.875rem;
            gap: 7px;
        }

        .attendance-add-blank-btn:hover {
            background-color: rgba(245, 158, 11, 0.9);
        }

        .attendance-add-blank-btn i {
            font-size: 1rem;
            margin-top: 2px;
        }

        .editstaff-btn,
        .editattendance-btn {
            color: #165DFF;
            border-style: none;
            background-color: transparent;
            margin-right: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        .deletestaff-btn,
        .deleteattendance-btn {
            color: #ee2e2e;
            border-style: none;
            background-color: transparent;
            font-size: 16px;
            cursor: pointer;
        }

        footer {
            background-color: #ffffff;
            border-top: 1px solid #e5e7eb;
            padding: 1rem 0;
        }

        .footer-container {
            width: 100%;
            min-width: 100%;
            margin: 0 auto;
            padding: 0 1rem;
            text-align: center;
            color: #6b7280;
            font-size: 13px;
        }

        .footer-container p {
            margin: 0 0 0.5rem 0;
        }

        .footer-container p:last-child {
            margin-bottom: 0;
        }

        @media (min-width: 640px) {
            header nav,
            main {
                max-width: 640px;
            }
            main {
                max-width: 640px;
            }
        }
        @media (min-width: 768px) {
            header nav,
            main {
                max-width: 768px;
            }
            header nav ul {
                gap: 1rem;
            }
            .staff-form {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            .edit-attendance-form {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            .search-wrapper {
                width: 16rem;
            }
            .staff-header {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 1rem;
            }
            .staff-title {
                margin-bottom: 0;
            }
        }
        @media (min-width: 1024px) {
            header nav,
            main {
                max-width: 1024px;
            }
            .staff-form {
                grid-template-columns: repeat(3, 1fr) !important;
            }
        }
        @media (min-width: 1280px) {
            header nav,
            main {
                max-width: 1280px;
            }
        }
        @media (min-width: 1536px) {
            header nav,
            main {
                max-width: 1536px;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="#file-upload" class="nav-link">文件上传</a></li>
                <li><a href="#staff-upload" class="nav-link">职工信息上传</a></li>
                <li><a href="#attendance-show" class="nav-link">信息展示</a></li>
                <li><a href="#data-arrange" class="nav-link">数据整理记录</a></li>
                <li class="relative-group">
                    <a href="#dean-pages" class="nav-link">
                        分管页面
                        <i class="fa fa-chevron-down ml-1 text-xs transition-transform group-hover:rotate-180"></i>
                    </a>
                    <div>
                        <a href="#dean-王雷" class="dean-link">王雷</a>
                        <a href="#dean-李春娟" class="dean-link">李春娟</a>
                        <a href="#dean-宋增信" class="dean-link">宋增信</a>
                        <a href="#dean-徐伟" class="dean-link">徐伟</a>
                        <a href="#dean-段海燕" class="dean-link">段海燕</a>
                        <a href="#dean-财务" class="dean-link">财务</a>
                    </div>
                </li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="file-upload" class="page-section file-upload">
            <div class="container">
                <h2 class="title">
                    <i class="fa fa-upload"></i>考勤文件上传
                </h2>
                <div class="drop-area" id="drop-area">
                    <input type="file" id="attendance-file" class="file-input" accept=".txt,.xlsx,.csv">
                    <i class="fa fa-file-text-o"></i>
                    <p>点击或拖拽文件至此处上传</p>
                    <p>支持 .txt、.xlsx、.csv 格式文件</p>
                    <button type="button" id="select-file-btn" class="select-file-btn">
                        选择文件
                    </button>
                </div>
                <div id="file-info" class="file-info">
                    <div class="file-info-card">
                        <div class="file-info-left">
                            <i class="fa fa-file-text-o"></i>
                            <span id="file-name" class="file-name"></span>
                        </div>
                        <button type="button" id="remove-file" class="remove-file-btn">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="upload-confirm-wrap">
                    <button type="button" id="upload-confirm" class="upload-confirm-btn">
                        <i class="fa fa-check"></i>确认上传
                    </button>
                </div>
            </div>
        </section>

        <section id="staff-upload" class="page-section staff-upload">
            <div class="container">
                <h2 class="title">
                    <i class="fa fa-solid fa-address-card"></i>职工信息上传
                </h2>
                <form id="staff-form" class="staff-form">
                    <div class="form-group">
                        <label for="staff-id" class="staff">工号 <span class="warring">*</span></label>
                        <input type="text" id="staff-id" name="staff-id" class="staff-input" required>
                    </div>
                    <div class="form-group">
                        <label for="staff-name" class="staff">姓名 <span class="warring">*</span></label>
                        <input type="text" id="staff-name" name="staff-name" class="staff-input" required>
                    </div>
                    <div class="form-group">
                        <label for="staff-department" class="staff">科室 <span class="warring">*</span></label>
                        <select id="staff-department" name="staff-department" class="staff-input" required>
                            <option value="">请选择科室</option>
                            <option value="内科">内科</option>
                            <option value="外科">外科</option>
                            <option value="理疗科">理疗科</option>
                            <option value="护理">护理</option>
                            <option value="急诊科">急诊科</option>
                            <option value="妇产科">妇产科</option>
                            <option value="儿科">儿科</option>
                            <option value="放射科">放射科</option>
                            <option value="检验科">检验科</option>
                            <option value="药房">药房</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="staff-status" class="staff">状态 <span class="warring">*</span></label>
                        <select id="staff-status" name="staff-status" class="staff-input" required>
                            <option value="">请选择状态</option>
                            <option value="正常">正常</option>
                            <option value="离退">离退</option>
                            <option value="外勤">外勤</option>
                            <option value="事假">事假</option>
                            <option value="病假">病假</option>
                            <option value="产假">产假</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="staff-dean" class="staff">分管 <span class="warring">*</span></label>
                        <select id="staff-dean" name="staff-dean" class="staff-input" required>
                            <option value="">请选择分管</option>
                            <option value="王雷">王雷</option>
                            <option value="李春娟">李春娟</option>
                            <option value="宋增信">宋增信</option>
                            <option value="徐伟">徐伟</option>
                            <option value="段海燕">段海燕</option>
                            <option value="财务">财务</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="staff-submit">
                            <i class="fa fa-save mr-2"></i>保存职工信息
                        </button>
                    </div>
                </form>
            </div>
            <div class="container">
                <div class="staff-header">
                    <h3 class="staff-title">职工信息管理</h3>
                    <div class="header-actions">
                        <div class="search-wrapper">
                            <input type="text" id="staff-search" class="search-input" placeholder="搜索工号、姓名、科室、分管...">
                            <i class="fa fa-search search-icon"></i>
                        </div>
                        <label class="batch-upload-label">
                            <i class="fa fa-upload"></i>
                            <span>批量上传</span>
                            <input type="file" id="staff-batch-upload" class="batch-upload-input" accept=".xlsx,.csv">
                        </label>
                        <button type="button" id="staff-clear-all" class="clear-all-btn">
                            <i class="fa fa-trash-can"></i>清空所有信息
                        </button>
                        <button type="button" id="staff-export" class="export-btn">
                            <i class="fa fa-download"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table cellpadding="0" cellspacing="0" class="staff-table">
                        <thead>
                            <tr class="table-header-row">
                                <th>工号</th>
                                <th>姓名</th>
                                <th>科室</th>
                                <th>状态</th>
                                <th>分管</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="staff-table-body">
                            <tr class="empty-row">
                                <td colspan="6" class="empty-cell">暂无职工信息，请添加或上传数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="attendance-show" class="page-section attendance-show">
            <div class="container">
                <div class="staff-header">
                    <h2 class="staff-title">
                        <i class="fa fa-table"></i>考勤信息展示
                    </h2>
                    <div class="header-actions">
                        <div class="search-wrapper">
                            <input type="text" id="attendance-search" class="search-input" placeholder="搜索日期、工号、姓名、科室、分管...">
                            <i class="fa fa-search search-icon"></i>
                        </div>
                        <div class="month-filter-wrapper">
                            <input type="month" id="attendance-month-filter" class="month-filter-input">
                        </div>
                        <button type="button" id="attendance-export" class="export-btn">
                            <i class="fa fa-download"></i>导出Excel
                        </button>
                        <button type="button" id="attendance-delete-month" class="delete-month-btn">
                            <i class="fa fa-trash"></i>删除指定月份
                        </button>
                        <button type="button" id="attendance-add-blank" class="attendance-add-blank-btn">
                            <i class="fa fa-plus"></i>增加空白表
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table cellpadding="0" cellspacing="0" class="attendance-table">
                        <thead class="attendance-table-row">
                            <tr>
                                <th>工号</th>
                                <th>姓名</th>
                                <th>科室</th>
                                <th>状态</th>
                                <th>分管</th>
                                <th>日期</th>
                                <th>考勤时间1</th>
                                <th>考勤时间2</th>
                                <th>考勤时间3</th>
                                <th>考勤时间4</th>
                                <th>考勤时间5</th>
                                <th>考勤时间6</th>
                                <th>考勤时间7</th>
                                <th>考勤时间8</th>
                                <th>考勤时间9</th>
                                <th>考勤时间10</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="attendance-table-body">
                            <tr class="attendance-empty-row">
                                <td colspan="17" class="attendance-empty-cell">暂无考勤信息，请添加空白表或上传考勤文件</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="data-arrange" class="page-section data-arrange">
            <div class="container">
                <div class="staff-header">
                    <h2 class="staff-title">
                        <i class="fa fa-bar-chart"></i>数据整理记录表
                    </h2>
                    <div class="header-actions">
                        <div class="search-wrapper">
                            <input type="text" id="arrange-search" class="search-input" placeholder="搜索日期、工号、姓名、科室、分管...">
                            <i class="fa fa-search search-icon"></i>
                        </div>
                        <div class="relative">
                            <input type="month" id="arrange-month-filter" class="month-filter-input">
                        </div>
                        <button type="button" id="arrange-export" class="export-btn">
                            <i class="fa fa-download"></i>导出Excel
                        </button>
                        <button type="button" id="arrange-delete-month" class="delete-month-btn hidden">
                            <i class="fa fa-trash"></i>删除指定月份
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table cellpadding="0" cellspacing="0" class="arrange-table">
                        <thead class="arrange-table-row">
                            <tr>
                                <th>工号</th>
                                <th>姓名</th>
                                <th>科室</th>
                                <th>状态</th>
                                <th>分管</th>
                                <th>日期</th>
                                <th>考勤时间1</th>
                                <th>考勤时间2</th>
                                <th>考勤时间3</th>
                                <th>考勤时间4</th>
                                <th>规则内考勤</th>
                                <th>规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody id="arrange-table-body">
                            <tr class="arrange-empty-row">
                                <td colspan="12" class="arrange-empty-cell">暂无整理数据，请先上传考勤文件</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-王雷" class="page-section dean-page" data-dean="王雷">
            <div class="container">
                <div class="staff-header">
                    <h2 class="staff-title">
                        <i class="fa fa-user-circle"></i>王雷 - 考勤记录表
                    </h2>
                    <div class="header-actions">
                        <div class="search-wrapper">
                            <input type="text" class="dean-search" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search search-icon"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter">
                        </div>
                        <button type="button" class="dean-export">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table cellpadding="0" cellspacing="0" class="arrange-table">
                        <thead class="arrange-table-row">
                            <tr>
                                <th>工号</th>
                                <th>姓名</th>
                                <th>科室</th>
                                <th>状态</th>
                                <th>日期</th>
                                <th>考勤时间1</th>
                                <th>考勤时间2</th>
                                <th>考勤时间3</th>
                                <th>考勤时间4</th>
                                <th>规则内考勤</th>
                                <th>规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="arrange-empty-row">
                                <td colspan="11" class="arrange-empty-cell">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-李春娟" class="page-section dean-page" data-dean="李春娟">
            <div class="container">
                <div class="staff-header">
                    <h2 class="staff-title">
                        <i class="fa fa-user-circle"></i>李春娟 - 考勤记录表
                    </h2>
                    <div class="header-actions">
                        <div class="search-wrapper">
                            <input type="text" class="dean-search" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search search-icon"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter">
                        </div>
                        <button type="button" class="dean-export">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table cellpadding="0" cellspacing="0" class="arrange-table">
                        <thead class="arrange-table-row">
                            <tr>
                                <th>工号</th>
                                <th>姓名</th>
                                <th>科室</th>
                                <th>状态</th>
                                <th>日期</th>
                                <th>考勤时间1</th>
                                <th>考勤时间2</th>
                                <th>考勤时间3</th>
                                <th>考勤时间4</th>
                                <th>规则内考勤</th>
                                <th>规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="arrange-empty-row">
                                <td colspan="11" class="arrange-empty-cell">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-宋增信" class="page-section dean-page" data-dean="宋增信">
            <div class="container">
                <div class="staff-header">
                    <h2 class="staff-title">
                        <i class="fa fa-user-circle"></i>宋增信 - 考勤记录表
                    </h2>
                    <div class="header-actions">
                        <div class="search-wrapper">
                            <input type="text" class="dean-search" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search search-icon"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter">
                        </div>
                        <button type="button" class="dean-export">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table cellpadding="0" cellspacing="0" class="arrange-table">
                        <thead class="arrange-table-row">
                            <tr>
                                <th>工号</th>
                                <th>姓名</th>
                                <th>科室</th>
                                <th>状态</th>
                                <th>日期</th>
                                <th>考勤时间1</th>
                                <th>考勤时间2</th>
                                <th>考勤时间3</th>
                                <th>考勤时间4</th>
                                <th>规则内考勤</th>
                                <th>规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="arrange-empty-row">
                                <td colspan="11" class="arrange-empty-cell">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-徐伟" class="page-section dean-page" data-dean="徐伟">
            <div class="container">
                <div class="staff-header">
                    <h2 class="staff-title">
                        <i class="fa fa-user-circle"></i>徐伟 - 考勤记录表
                    </h2>
                    <div class="header-actions">
                        <div class="search-wrapper">
                            <input type="text" class="dean-search" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search search-icon"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter">
                        </div>
                        <button type="button" class="dean-export">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table cellpadding="0" cellspacing="0" class="arrange-table">
                        <thead class="arrange-table-row">
                            <tr>
                                <th>工号</th>
                                <th>姓名</th>
                                <th>科室</th>
                                <th>状态</th>
                                <th>日期</th>
                                <th>考勤时间1</th>
                                <th>考勤时间2</th>
                                <th>考勤时间3</th>
                                <th>考勤时间4</th>
                                <th>规则内考勤</th>
                                <th>规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="arrange-empty-row">
                                <td colspan="11" class="arrange-empty-cell">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-段海燕" class="page-section dean-page" data-dean="段海燕">
            <div class="container">
                <div class="staff-header">
                    <h2 class="staff-title">
                        <i class="fa fa-user-circle"></i>段海燕 - 考勤记录表
                    </h2>
                    <div class="header-actions">
                        <div class="search-wrapper">
                            <input type="text" class="dean-search" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search search-icon"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter">
                        </div>
                        <button type="button" class="dean-export">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table cellpadding="0" cellspacing="0" class="arrange-table">
                        <thead class="arrange-table-row">
                            <tr>
                                <th>工号</th>
                                <th>姓名</th>
                                <th>科室</th>
                                <th>状态</th>
                                <th>日期</th>
                                <th>考勤时间1</th>
                                <th>考勤时间2</th>
                                <th>考勤时间3</th>
                                <th>考勤时间4</th>
                                <th>规则内考勤</th>
                                <th>规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="arrange-empty-row">
                                <td colspan="11" class="arrange-empty-cell">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-财务" class="page-section dean-page" data-dean="财务">
            <div class="container">
                <div class="staff-header">
                    <h2 class="staff-title">
                        <i class="fa fa-user-circle"></i>财务 - 考勤记录表
                    </h2>
                    <div class="header-actions">
                        <div class="search-wrapper">
                            <input type="text" class="dean-search" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search search-icon"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter">
                        </div>
                        <button type="button" class="dean-export">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table cellpadding="0" cellspacing="0" class="arrange-table">
                        <thead class="arrange-table-row">
                            <tr>
                                <th>工号</th>
                                <th>姓名</th>
                                <th>科室</th>
                                <th>状态</th>
                                <th>日期</th>
                                <th>考勤时间1</th>
                                <th>考勤时间2</th>
                                <th>考勤时间3</th>
                                <th>考勤时间4</th>
                                <th>规则内考勤</th>
                                <th>规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="arrange-empty-row">
                                <td colspan="11" class="arrange-empty-cell">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <div id="notification" class="notification">
        <div id="notification-message" class="notification-message"></div>
    </div>

    <div id="edit-staff-modal" class="edit-staff-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">编辑职工信息</h3>
                <button type="button" id="close-edit-modal" class="close-edit-modal">
                    <i class="fa fa-xmark"></i>
                </button>
            </div>
            <form id="edit-staff-form" class="edit-staff-form">
                <input type="hidden" id="edit-staff-id" class="edit-staff-id">
                <div class="form-group">
                    <label for="edit-staff-name">姓名 <span class="warring">*</span></label>
                    <input type="text" id="edit-staff-name" name="edit-staff-name" required>
                </div>
                <div class="form-group">
                    <label for="edit-staff-department">科室 <span class="warring">*</span></label>
                    <select id="edit-staff-department" name="edit-staff-department" required>
                        <option value="">请选择科室</option>
                        <option value="内科">内科</option>
                        <option value="外科">外科</option>
                        <option value="理疗">理疗</option>
                        <option value="护理">护理</option>
                        <option value="妇儿">妇儿</option>
                        <option value="公卫">公卫</option>
                        <option value="药房">药房</option>
                        <option value="防疫">防疫</option>
                        <option value="B超">B超</option>
                        <option value="放射">放射</option>
                        <option value="财务">财务</option>
                        <option value="化验">化验</option>
                        <option value="收费">收费</option>
                        <option value="口腔">口腔</option>
                        <option value="办公室">办公室</option>
                        <option value="居民医保">居民医保</option>
                        <option value="药库">药库</option>
                        <option value="后勤">后勤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-staff-status">状态 <span class="warring">*</span></label>
                    <select id="edit-staff-status" name="edit-staff-status" required>
                        <option value="">请选择状态</option>
                        <option value="正常">正常</option>
                        <option value="离退">离退</option>
                        <option value="外勤">外勤</option>
                        <option value="事假">事假</option>
                        <option value="病假">病假</option>
                        <option value="产假">产假</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-staff-dean">分管 <span class="warring">*</span></label>
                    <select id="edit-staff-dean" name="edit-staff-dean" required>
                        <option value="">请选择分管</option>
                        <option value="王雷">王雷</option>
                        <option value="李春娟">李春娟</option>
                        <option value="宋增信">宋增信</option>
                        <option value="徐伟">徐伟</option>
                        <option value="段海燕">段海燕</option>
                        <option value="财务">财务</option>
                    </select>
                </div>
                <div class="form-group btn-group">
                    <button type="button" id="cancel-edit" class="cancel-edit">取消</button>
                    <button type="submit">保存修改</button>
                </div>
            </form>
        </div>
    </div>

    <div id="edit-attendance-modal" class="edit-attendance-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="model-title">编辑考勤信息</h3>
                <button type="button" id="close-attendance-modal" class="close-attendance-modal">
                    <i class="fa fa-xmark"></i>
                </button>
            </div>
            <form id="edit-attendance-form" class="edit-attendance-form">
                <input type="hidden" id="edit-attendance-record-id">

                <div class="form-group">
                    <label for="edit-attendance-id">工号</label>
                    <input type="text" id="edit-attendance-id" class="edit-attendance-id" readonly>
                </div>

                <div class="form-group">
                    <label for="edit-attendance-name">姓名</label>
                    <input type="text" id="edit-attendance-name" class="edit-attendance-name" readonly>
                </div>

                <div class="form-group">
                    <label for="edit-attendance-department">科室</label>
                    <input type="text" id="edit-attendance-department" class="edit-attendance-department" readonly>
                </div>

                <div class="form-group">
                    <label for="edit-attendance-dean">分管</label>
                    <input type="text" id="edit-attendance-dean" class="edit-attendance-dean" readonly>
                </div>

                <div class="form-group">
                    <label for="edit-attendance-date">日期 <span class="warring">*</span></label>
                    <input type="date" id="edit-attendance-date" class="edit-attendance-date" required>
                </div>

                <div class="form-group">
                    <label for="edit-attendance-status">状态</label>
                    <input type="text" id="edit-attendance-status" class="edit-attendance-status" readonly>
                </div>  

                <div class="form-group time-group">
                    <div>
                        <label for="edit-attendance-time1">考勤时间1</label>
                        <input type="time" id="edit-attendance-time1" class="edit-attendance-time1">
                    </div>
                    <div>
                        <label for="edit-attendance-time2">考勤时间2</label>
                        <input type="time" id="edit-attendance-time2" class="edit-attendance-time2">
                    </div>
                    <div>
                        <label for="edit-attendance-time3">考勤时间3</label>
                        <input type="time" id="edit-attendance-time3" class="edit-attendance-time3">
                    </div>
                    <div>
                        <label for="edit-attendance-time4">考勤时间4</label>
                        <input type="time" id="edit-attendance-time4" class="edit-attendance-time4">
                    </div>
                    <div>
                        <label for="edit-attendance-time5">考勤时间5</label>
                        <input type="time" id="edit-attendance-time5" class="edit-attendance-time5">
                    </div>
                </div>
                
                <div class="form-group time-group">
                    <div>
                        <label for="edit-attendance-time6">考勤时间6</label>
                        <input type="time" id="edit-attendance-time6" class="edit-attendance-time6">
                    </div>
                    <div>
                        <label for="edit-attendance-time7">考勤时间7</label>
                        <input type="time" id="edit-attendance-time7" class="edit-attendance-time7">
                    </div>
                    <div>
                        <label for="edit-attendance-time8">考勤时间8</label>
                        <input type="time" id="edit-attendance-time8" class="edit-attendance-time8">
                    </div>
                    <div>
                        <label for="edit-attendance-time9">考勤时间9</label>
                        <input type="time" id="edit-attendance-time9" class="edit-attendance-time9">
                    </div>
                    <div>
                        <label for="edit-attendance-time10">考勤时间10</label>
                        <input type="time" id="edit-attendance-time10" class="edit-attendance-time10">
                    </div>
                </div>
                
                <div class="form-group btn-group">
                    <button type="button" id="cancel-attendance-edit" class="cancel-attendance-edit">取消</button>
                    <button type="submit">保存修改</button>
                </div>
            </form>
        </div>
    </div>

    

    <footer>
        <div class="footer-container">
            <p>© 2026 考勤管理系统 | 打造智能考勤，赋能高效管理</p>
            <p>保留所有权利 | 技术维护：信息科</a></p>
        </div>
    </footer>

    <script>
        const DataStore = {
            getStaffData() {
                const data = localStorage.getItem('staffData');
                return data ? JSON.parse(data) : [];
            },
            
            saveStaffData(data) {
                localStorage.setItem('staffData', JSON.stringify(data));
            },
            
            getAttendanceData() {
                const data = localStorage.getItem('attendanceData');
                return data ? JSON.parse(data) : [];
            },
            
            saveAttendanceData(data) {
                localStorage.setItem('attendanceData', JSON.stringify(data));
            },
            
            getArrangedData() {
                const data = localStorage.getItem('arrangedData');
                return data ? JSON.parse(data) : [];
            },
            
            saveArrangedData(data) {
                localStorage.setItem('arrangedData', JSON.stringify(data));
            },
            
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
            }
        };

        const Notification = {
            show(message, type = 'success') {
                const notification = document.getElementById('notification');
                const messageEl = document.getElementById('notification-message');

                Object.assign(notification.style, {
                    position: 'fixed',
                    top: '6rem',
                    right: '1.5rem',
                    maxWidth: '28rem',
                    padding: '1rem',
                    borderRadius: '0.5rem',
                    boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)',
                    transition: 'transform 0.3s ease',
                    display: 'flex',
                    alignItems: 'center',
                    zIndex: '50',
                });                
                
                notification.style.transform = 'translateX(0)';

                messageEl.textContent = message;

                switch(type) {
                    case 'success':
                        notification.style.backgroundColor = '#0f9716';
                        notification.style.color = 'white';
                        break;
                    case 'error':
                        notification.style.backgroundColor = '#a31e0d';
                        notification.style.color = 'white';
                        break;
                    case 'warning':
                        notification.style.backgroundColor = '#e66a17';
                        notification.style.color = 'white';
                        break;
                    case 'info':
                        notification.style.backgroundColor = '#1b70d1';
                        notification.style.color = 'white';
                        break;
                    default:
                        notification.style.backgroundColor = '#1b70d1';
                        notification.style.color = 'white';
                }

                setTimeout(() => {
                    notification.style.transform = 'translateX(calc(100% + 1.5rem))';
                    
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 300);
                }, 1500);
            },
        };

        const PageSwitcher = {
            init() {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('href');
                        this.showPage(targetId);
                        
                        document.querySelectorAll('.nav-link').forEach(item => {
                            item.classList.remove('active');
                        });
                        link.classList.add('active');
                    });
                });
                
                document.querySelectorAll('.dean-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('href');
                        this.showPage(targetId);
                    
                        document.querySelectorAll('.nav-link').forEach(item => {
                            item.classList.remove('active');
                        });
                        
                        document.querySelector('a[href="#dean-pages"]').classList.add('active'); 
                    });
                });
                
                this.showPage('#file-upload');
                document.querySelector('.nav-link').classList.add('active');
            },
            
            showPage(pageId) {
                document.querySelectorAll('.page-section').forEach(section => {
                    section.classList.add('hidden');
                    section.classList.remove('block');
                });
                
                const targetPage = document.querySelector(pageId);
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                    targetPage.classList.add('block');
                    
                    if (pageId.startsWith('#dean-')) {
                        const deanName = pageId.replace('#dean-', '');
                        if (typeof DeanPage !== 'undefined' && DeanPage.renderDeanData) {
                            DeanPage.renderDeanData(deanName);
                        }
                    }
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            PageSwitcher.init();
        });

        const FileHandler = {
            parseTxtFile(content) {
                try {
                    content = content.trim()
                        .replace(/^\s*Return\s*/, '')
                        .replace(/\r\n|\r|\n/g, ' ');
                    
                    const timeRegex = /time="([^"]+)"\s+id="([^"]+)"\s+name="([^"]+)"/g;
                    const results = [];
                    let match;
                    
                    while ((match = timeRegex.exec(content)) !== null) {
                        const [, datetime, id, name] = match;
                        const [date, time] = datetime.includes(' ') 
                            ? datetime.split(' ') 
                            : [datetime.slice(0, 10), datetime.slice(10)];
                        
                        results.push({ date, time, id, name });
                    }

                    if (results.length === 0) {
                        Notification.show('未解析到任何考勤记录，请检查文件格式', 'warning');
                    }
                    
                    return results;
                } catch (error) {
                    console.error('解析 TXT 文件失败:', error);
                    Notification.show('解析 TXT 文件失败，请检查文件格式', 'error');
                    return [];
                }
            },
            
            parseExcelFile(workbook) {
                try {
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    const results = jsonData.map(item => {
                        const date = item['日期'] || item['date'] || '';
                        const time = item['时间'] || item['time'] || '';
                        const id = item['工号'] || item['id'] || item['ID'] || '';
                        const name = item['姓名'] || item['name'] || '';
                        return { date, time, id: id.toString(), name };
                    }).filter(item => item.date && item.time && item.id && item.name);
                    
                    return results;
                } catch (error) {
                    console.error('解析 Excel 文件失败:', error);
                    Notification.show('解析 Excel 文件失败，请检查文件格式', 'error');
                    return [];
                }
            },
            
            parseStaffFile(workbook) {
                try {
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    const results = jsonData.map(item => {
                        return {
                            id: (item['工号'] || item['id'] || item['设备工号'] || '').toString().trim(),
                            name: (item['姓名'] || item['name'] || '').trim(),
                            department: (item['科室'] || item['department'] || item['所属科室'] || '').trim(),
                            status: (item['状态'] || item['status'] || '').trim(),
                            dean: (item['分管'] || item['dean'] || item['分管院长'] || item['分管领导'] || '').trim()
                        };
                    }).filter(item => item.id && item.name && item.department && item.status && item.dean);
                    
                    return results;
                } catch (error) {
                    console.error('解析职工文件失败:', error);
                    Notification.show('解析职工文件失败，请检查文件格式', 'error');
                    return [];
                }
            }
        };

        const StaffManager = {
            init() {
                this.renderStaffList();
                
                document.getElementById('staff-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addStaff();
                });
                
                document.getElementById('staff-search').addEventListener('input', () => {
                    this.renderStaffList();
                });
                
                document.getElementById('staff-batch-upload').addEventListener('change', (e) => {
                    this.batchUploadStaff(e.target.files[0]);
                });
                
                document.getElementById('staff-clear-all').addEventListener('click', () => {
                    if (confirm('确定要清空所有职工信息吗？此操作不可恢复！')) {
                        DataStore.saveStaffData([]);
                        this.renderStaffList();
                        Notification.show('所有职工信息已清空', 'warning');
                    }
                });
                
                document.getElementById('staff-export').addEventListener('click', () => {
                    this.exportStaffExcel();
                });
                
                document.getElementById('close-edit-modal').addEventListener('click', () => {
                    document.getElementById('edit-staff-modal').classList.remove('show');
                });
                document.getElementById('cancel-edit').addEventListener('click', () => {
                    document.getElementById('edit-staff-modal').classList.remove('show');
                });
                
                document.getElementById('edit-staff-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateStaff();
                    document.getElementById('edit-staff-modal').classList.remove('show');
                });
            },
            
            addStaff() {
                const id = document.getElementById('staff-id').value.trim();
                const name = document.getElementById('staff-name').value.trim();
                const department = document.getElementById('staff-department').value;
                const status = document.getElementById('staff-status').value;
                const dean = document.getElementById('staff-dean').value;
                
                if (!id || !name || !department || !status || !dean) {
                    Notification.show('请填写完整的职工信息', 'error');
                    return;
                }
                
                const staffData = DataStore.getStaffData();
                
                const exists = staffData.some(staff => staff.id === id);
                if (exists) {
                    Notification.show(`工号${id}已存在，请检查输入信息`, 'error');
                    return;
                }
                
                const newStaff = {
                    id,
                    name,
                    department,
                    status,
                    dean,
                    createTime: new Date().toISOString()
                };
                
                staffData.push(newStaff);
                DataStore.saveStaffData(staffData);
                
                document.getElementById('staff-form').reset();
                
                this.renderStaffList();
                Notification.show(`保存成功1条职工信息`, 'success');
            },
            
            batchUploadStaff(file) {
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const staffList = FileHandler.parseStaffFile(workbook);
                        
                        if (staffList.length === 0) {
                            Notification.show('未解析到有效职工数据', 'warning');
                            return;
                        }
                        
                        const existingStaff = DataStore.getStaffData();
                        const newStaffList = [...existingStaff];
                        let successCount = 0;
                        let duplicateCount = 0;
                        
                        staffList.forEach(staff => {
                            const exists = newStaffList.some(s => s.id === staff.id);
                            if (!exists) {
                                newStaffList.push({
                                    ...staff,
                                    createTime: new Date().toISOString()
                                });
                                successCount++;
                            } else {
                                duplicateCount++;
                            }
                        });
                        
                        DataStore.saveStaffData(newStaffList);
                        StaffManager.renderStaffList();
                        
                        let message = `批量上传成功！新增${successCount}条职工信息`;
                        if (duplicateCount > 0) {
                            message += `，跳过${duplicateCount}条重复工号数据`;
                        }
                        Notification.show(message, 'success');
                    } catch (error) {
                        console.error('批量上传职工失败:', error);
                        Notification.show('批量上传职工失败，请检查文件格式', 'error');
                    }
                };
                reader.readAsArrayBuffer(file);
            },
            
            updateStaff() {
                const id = document.getElementById('edit-staff-id').value;
                const name = document.getElementById('edit-staff-name').value.trim();
                const department = document.getElementById('edit-staff-department').value;
                const status = document.getElementById('edit-staff-status').value;
                const dean = document.getElementById('edit-staff-dean').value;
                
                if (!name || !department || !status || !dean) {
                    Notification.show('请填写完整的职工信息', 'error');
                    return;
                }
                
                const staffData = DataStore.getStaffData();
                const index = staffData.findIndex(staff => staff.id === id);
                
                if (index !== -1) {
                    staffData[index] = {
                        ...staffData[index],
                        name,
                        department,
                        status,
                        dean,
                        updateTime: new Date().toISOString()
                    };
                    
                    DataStore.saveStaffData(staffData);
                    this.renderStaffList();
                    document.getElementById('edit-staff-modal').classList.add('show');
                    
                    AttendanceManager.updateStaffInfoInAttendance(id, name, department, status, dean);
                    Notification.show('职工信息更新成功', 'success');
                }
            },
            
            deleteStaff(id) {
                if (confirm('确定要删除该职工信息吗？相关考勤数据也会被删除！')) {
                    let staffData = DataStore.getStaffData();
                    staffData = staffData.filter(staff => staff.id !== id);
                    DataStore.saveStaffData(staffData);
                    
                    AttendanceManager.deleteAttendanceByStaffId(id);
                    this.renderStaffList();
                    Notification.show('职工信息已删除', 'success');
                }
            },
            
            editStaff(id) {
                const staffData = DataStore.getStaffData();
                const staff = staffData.find(s => s.id === id);
                
                if (staff) {
                    document.getElementById('edit-staff-id').value = staff.id;
                    document.getElementById('edit-staff-name').value = staff.name;
                    document.getElementById('edit-staff-department').value = staff.department;
                    document.getElementById('edit-staff-status').value = staff.status;
                    document.getElementById('edit-staff-dean').value = staff.dean;
                    document.getElementById('edit-staff-modal').classList.add('show');
                }
            },
            
            renderStaffList() {
                const staffData = DataStore.getStaffData();
                const searchTerm = document.getElementById('staff-search').value.toLowerCase().trim();
                const tableBody = document.getElementById('staff-table-body');
                
                const filteredData = staffData.filter(staff => {
                    return staff.id.toLowerCase().includes(searchTerm) ||
                            staff.name.toLowerCase().includes(searchTerm) ||
                            staff.department.toLowerCase().includes(searchTerm) ||
                            staff.dean.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    tableBody.innerHTML = `
                        <tr class="text-center">
                        <td colspan="6" class="px-4 py-8 text-gray-500">暂无匹配的职工信息</td>
                        </tr>
                    `;
                    return;
                }
                
                let html = '';
                filteredData.forEach(staff => {
                    html += `
                        <tr>
                        <td>${staff.id}</td>
                        <td>${staff.name}</td>
                        <td>${staff.department}</td>
                        <td>${staff.status}</td>
                        <td>${staff.dean}</td>
                        <td>
                            <button onclick="StaffManager.editStaff('${staff.id}')" class="editstaff-btn">
                            <i class="fa fa-pencil"></i> 编辑
                            </button>
                            <button onclick="StaffManager.deleteStaff('${staff.id}')" class="deletestaff-btn">
                            <i class="fa fa-trash"></i> 删除
                            </button>
                        </td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            },
            
            exportStaffExcel() {
                const staffData = DataStore.getStaffData();
                if (staffData.length === 0) {
                    Notification.show('暂无职工数据可导出', 'warning');
                    return;
                }
                
                const exportData = staffData.map(staff => {
                    return {
                        '工号': staff.id,
                        '姓名': staff.name,
                        '科室': staff.department,
                        '状态': staff.status,
                        '分管': staff.dean
                    };
                });
                
                const worksheet = XLSX.utils.json_to_sheet(exportData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, '职工信息');
                
                XLSX.writeFile(workbook, `职工信息表_${new Date().toLocaleDateString()}.xlsx`);
                Notification.show('职工信息导出成功', 'success');
            },
            
            getStaffById(id) {
                const staffData = DataStore.getStaffData();
                return staffData.find(staff => staff.id === id) || null;
            }
        };

        const AttendanceManager = {
            init() {
                this.renderAttendanceList();
                
                this.renderArrangedData();
                
                document.getElementById('attendance-search').addEventListener('input', () => {
                    this.renderAttendanceList();
                });
                
                document.getElementById('attendance-month-filter').addEventListener('change', () => {
                    this.renderAttendanceList();
                });
                
                document.getElementById('attendance-export').addEventListener('click', () => {
                    this.exportAttendanceExcel();
                });
                
                document.getElementById('attendance-delete-month').addEventListener('click', () => {
                    this.deleteAttendanceByMonth();
                });
                
                document.getElementById('attendance-add-blank').addEventListener('click', () => {
                    this.addBlankAttendanceTable();
                });
                
                document.getElementById('arrange-search').addEventListener('input', () => {
                    this.renderArrangedData();
                });
                
                document.getElementById('arrange-month-filter').addEventListener('change', () => {
                    this.renderArrangedData();
                });
                
                document.getElementById('arrange-export').addEventListener('click', () => {
                    this.exportArrangedExcel();
                });
                
                document.getElementById('arrange-delete-month').addEventListener('click', () => {
                    this.deleteArrangedByMonth();
                });
                
                document.getElementById('select-file-btn').addEventListener('click', () => {
                    document.getElementById('attendance-file').click();
                });
                
                document.getElementById('attendance-file').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        document.getElementById('file-name').textContent = file.name;
                        document.getElementById('file-info').style.display = 'block';
                    }                    
                });
                
                document.getElementById('remove-file').addEventListener('click', () => {
                    document.getElementById('attendance-file').value = '';
                    document.getElementById('file-info').classList.add('hidden');
                });
                
                document.getElementById('upload-confirm').addEventListener('click', () => {
                    this.uploadAttendanceFile();
                });
                
                const dropArea = document.getElementById('drop-area');
                dropArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropArea.classList.add('border-primary', 'bg-primary/5');
                });
                dropArea.addEventListener('dragleave', () => {
                    dropArea.classList.remove('border-primary', 'bg-primary/5');
                });
                dropArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropArea.classList.remove('border-primary', 'bg-primary/5');
                    const file = e.dataTransfer.files[0];
                    if (file) {
                        document.getElementById('attendance-file').files = e.dataTransfer.files;
                        document.getElementById('file-name').textContent = file.name;
                        document.getElementById('file-info').classList.remove('hidden');
                    }
                });
                
                document.getElementById('close-attendance-modal').addEventListener('click', () => {
                    document.getElementById('edit-attendance-modal').classList.remove('show');
                });
                document.getElementById('cancel-attendance-edit').addEventListener('click', () => {
                    document.getElementById('edit-attendance-modal').classList.remove('show');
                });
                
                document.getElementById('edit-attendance-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateAttendance();
                    document.getElementById('edit-attendance-modal').classList.remove('show');
                });
                
                document.querySelectorAll('.dean-search').forEach(input => {
                    input.addEventListener('input', function() {
                        const deanPage = this.closest('.dean-page');
                        const deanName = deanPage.dataset.dean;
                        DeanPage.renderDeanData(deanName);
                    });
                });
                
                document.querySelectorAll('.dean-month-filter').forEach(input => {
                    input.addEventListener('change', function() {
                        const deanPage = this.closest('.dean-page');
                        const deanName = deanPage.dataset.dean;
                        DeanPage.renderDeanData(deanName);
                    });
                });
                
                document.querySelectorAll('.dean-export').forEach(button => {
                    button.addEventListener('click', function() {
                        const deanPage = this.closest('.dean-page');
                        const deanName = deanPage.dataset.dean;
                        DeanPage.exportDeanExcel(deanName);
                    });
                });
            },
            
            uploadAttendanceFile() {
                const fileInput = document.getElementById('attendance-file');
                const file = fileInput.files[0];
                
                if (!file) {
                    Notification.show('请先选择要上传的文件', 'error');
                    return;
                }
                
                const reader = new FileReader();
                const fileName = file.name;
                const fileExtension = fileName.split('.').pop().toLowerCase();
                
                reader.onload = function(e) {
                    try {
                        let attendanceRecords;
                        
                        if (fileExtension === 'txt') {
                            attendanceRecords = FileHandler.parseTxtFile(e.target.result);
                        } else if (['xlsx', 'csv'].includes(fileExtension)) {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            attendanceRecords = FileHandler.parseExcelFile(workbook);
                        } else {
                            Notification.show('不支持的文件格式', 'error');
                            return;
                        }
                        
                        if (attendanceRecords.length === 0) {
                            Notification.show('未解析到有效考勤数据', 'warning');
                            return;
                        }
                        
                        AttendanceManager.saveAttendanceRecords(attendanceRecords);
                        
                        fileInput.value = '';
                        document.getElementById('file-info').classList.add('hidden');
                        Notification.show(`成功上传${attendanceRecords.length}条考勤记录`, 'success');
                    } catch (error) {
                        console.error('上传考勤文件失败:', error);
                        Notification.show('上传考勤文件失败，请重试', 'error');
                    }
                };
                
                if (fileExtension === 'txt') {
                    reader.readAsText(file, 'UTF-8');
                } else {
                    reader.readAsArrayBuffer(file);
                }
            },
            
            saveAttendanceRecords(records) {
                let attendanceData = DataStore.getAttendanceData();
                
                records.forEach(record => {
                    const { date, time, id, name } = record;
                    const staffInfo = StaffManager.getStaffById(id) || {
                        name,
                        department: '未知',
                        status: '正常',
                        dean: '未知'
                    };
                    
                    let existingRecordIndex = attendanceData.findIndex(item =>
                        item.id === id && item.date === date
                    );
                    
                    if (existingRecordIndex !== -1) {
                        const existingRecord = attendanceData[existingRecordIndex];
                        let timeAdded = false;
                        
                        for (let i = 1; i <= 10; i++) {
                            const timeField = `time${i}`;
                            if (!existingRecord[timeField] || existingRecord[timeField] === '') {
                                existingRecord[timeField] = time;
                                timeAdded = true;
                                break;
                            }
                        }
                        
                        if (!timeAdded) {
                            alert(`工号${id}在${date}的考勤时间已达10条上限,请检查后续记录`);
                        }
                    } else {
                        const newRecord = {
                            id,
                            name: staffInfo.name,
                            department: staffInfo.department,
                            status: staffInfo.status,
                            dean: staffInfo.dean,
                            date,
                            time1: time,
                            time2: '',
                            time3: '',
                            time4: '',
                            time5: '',
                            time6: '',
                            time7: '',
                            time8: '',
                            time9: '',
                            time10: '',
                            recordId: DataStore.generateId()
                        };
                        attendanceData.push(newRecord);
                    }
                });
                
                attendanceData.sort((a, b) => {
                    if (a.id !== b.id) return a.id.localeCompare(b.id);
                    return a.date.localeCompare(b.date);
                });
                
                DataStore.saveAttendanceData(attendanceData);
                
                this.arrangeAttendanceData();
                
                this.renderAttendanceList();
                this.renderArrangedData();
                
                ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                    DeanPage.renderDeanData(dean);
                });
            },
            
            arrangeAttendanceData() {
                const attendanceData = DataStore.getAttendanceData();
                const arrangedData = [];
                
                attendanceData.forEach(record => {
                    const { id, name, department, status, dean, date } = record;
                    
                    const allTimes = [];
                    for (let i = 1; i <= 10; i++) {
                        const time = record[`time${i}`];
                        if (time && time.trim() !== '') {
                            allTimes.push(time.trim());
                        }
                    }
                    
                    const isInTimeRange = (time, start, end) => {
                        const timeStr = time.split(':').join('');
                        const startStr = start.split(':').join('');
                        const endStr = end.split(':').join('');
                        return timeStr >= startStr && timeStr <= endStr;
                    };
                    
                    let arranged = {
                        id,
                        name,
                        department,
                        status,
                        dean,
                        date,
                        time1: '',
                        time2: '',
                        time3: '',
                        time4: '',
                        ruleIn: [],
                        ruleOut: [],
                        recordId: record.recordId
                    };
                    
                    const usedIndexes = new Set();
                    
                    for (let i = 0; i < allTimes.length; i++) {
                        const time = allTimes[i];
                        if (isInTimeRange(time, '05:00:00', '09:00:00')) {
                            arranged.time1 = time;
                            usedIndexes.add(i);
                            break;
                        }
                    }
                    
                    for (let i = 0; i < allTimes.length; i++) {
                        if (usedIndexes.has(i)) continue;
                        const time = allTimes[i];
                        if (isInTimeRange(time, '11:00:00', '11:30:00') ||
                            isInTimeRange(time, '12:00:00', '12:30:00')) {
                            arranged.time2 = time;
                            usedIndexes.add(i);
                            break;
                        }
                    }
                    
                    for (let i = 0; i < allTimes.length; i++) {
                        if (usedIndexes.has(i)) continue;
                        const time = allTimes[i];
                        if (isInTimeRange(time, '11:30:00', '12:00:00') ||
                            isInTimeRange(time, '13:00:00', '13:30:00')) {
                            arranged.time3 = time;
                            usedIndexes.add(i);
                            break;
                        }
                    }
                    
                    for (let i = 0; i < allTimes.length; i++) {
                        if (usedIndexes.has(i)) continue;
                        const time = allTimes[i];
                        if (isInTimeRange(time, '15:30:00', '16:00:00') ||
                            isInTimeRange(time, '16:30:00', '17:00:00')) {
                            arranged.time4 = time;
                            usedIndexes.add(i);
                            break;
                        }
                    }
                    
                    for (let i = 0; i < allTimes.length; i++) {
                        if (usedIndexes.has(i)) continue;
                        const time = allTimes[i];
                        
                        const isRule1 = isInTimeRange(time, '05:00:00', '09:00:00');
                        const isRule2 = isInTimeRange(time, '11:00:00', '11:30:00') || isInTimeRange(time, '12:00:00', '12:30:00');
                        const isRule3 = isInTimeRange(time, '11:30:00', '12:00:00') || isInTimeRange(time, '13:00:00', '13:30:00');
                        const isRule4 = isInTimeRange(time, '15:30:00', '16:00:00') || isInTimeRange(time, '16:30:00', '17:00:00');
                        
                        if (isRule1 || isRule2 || isRule3 || isRule4) {
                            arranged.ruleIn.push(time);
                        } else {
                            arranged.ruleOut.push(time);
                        }
                    }
                    
                    arranged.ruleIn = arranged.ruleIn.join(', ');
                    arranged.ruleOut = arranged.ruleOut.join(', ');
                    arrangedData.push(arranged);
                });
                
                DataStore.saveArrangedData(arrangedData);
            },
            
            addBlankAttendanceTable() {
                const month = prompt('请输入要添加空白表的月份（格式：YYYY-MM）', '2025-01');
                if (!month) return;
                
                if (!/^\d{4}-\d{2}$/.test(month)) {
                    Notification.show('月份格式不正确，请输入 YYYY-MM 格式', 'error');
                    return;
                }
                
                const [year, monthNum] = month.split('-').map(Number);
                const daysInMonth = new Date(year, monthNum, 0).getDate();
                const staffData = DataStore.getStaffData();
                
                if (staffData.length === 0) {
                    Notification.show('暂无职工信息，请先添加职工', 'error');
                    return;
                }
                
                let attendanceData = DataStore.getAttendanceData();
                let addedCount = 0;
                
                staffData.forEach(staff => {
                    for (let day = 1; day <= daysInMonth; day++) {
                        const date = `${year}-${String(monthNum).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        
                        const exists = attendanceData.some(record =>
                            record.id === staff.id && record.date === date
                        );
                        
                        if (!exists) {
                            const newRecord = {
                                id: staff.id,
                                name: staff.name,
                                department: staff.department,
                                status: staff.status,
                                dean: staff.dean,
                                date,
                                time1: '',
                                time2: '',
                                time3: '',
                                time4: '',
                                time5: '',
                                time6: '',
                                time7: '',
                                time8: '',
                                time9: '',
                                time10: '',
                                recordId: DataStore.generateId()
                            };
                            attendanceData.push(newRecord);
                            addedCount++;
                        }
                    }
                });
                
                DataStore.saveAttendanceData(attendanceData);
                
                this.arrangeAttendanceData();
                
                this.renderAttendanceList();
                this.renderArrangedData();
                Notification.show(`成功添加${addedCount}条空白考勤记录`, 'success');
            },
            
            renderAttendanceList() {
                const attendanceData = DataStore.getAttendanceData();
                const searchTerm = document.getElementById('attendance-search').value.toLowerCase().trim();
                const monthFilter = document.getElementById('attendance-month-filter').value;
                const tableBody = document.getElementById('attendance-table-body');
                
                const filteredData = attendanceData.filter(record => {
                    if (monthFilter && !record.date.startsWith(monthFilter)) {
                        return false;
                    }
                    
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm) ||
                            record.dean.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                        <td>暂无匹配的考勤信息</td>
                        </tr>
                    `;
                    return;
                }
                
                let html = '';
                filteredData.forEach(record => {
                    html += `
                        <tr>
                        <td>${record.id}</td>
                        <td>${record.name}</td>
                        <td>${record.department}</td>
                        <td>${record.status}</td>
                        <td>${record.dean}</td>
                        <td>${record.date}</td>
                        <td>${record.time1 || ''}</td>
                        <td>${record.time2 || ''}</td>
                        <td>${record.time3 || ''}</td>
                        <td>${record.time4 || ''}</td>
                        <td>${record.time5 || ''}</td>
                        <td>${record.time6 || ''}</td>
                        <td>${record.time7 || ''}</td>
                        <td>${record.time8 || ''}</td>
                        <td>${record.time9 || ''}</td>
                        <td>${record.time10 || ''}</td>
                        <td>
                            <button onclick="AttendanceManager.editAttendance('${record.recordId}')" class="editattendance-btn">
                            <i class="fa fa-pencil"></i> 编辑
                            </button>
                            <button onclick="AttendanceManager.deleteAttendance('${record.recordId}')" class="deleteattendance-btn">
                            <i class="fa fa-trash"></i> 删除
                            </button>
                        </td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            },
            
            renderArrangedData() {
                const arrangedData = DataStore.getArrangedData();
                const searchTerm = document.getElementById('arrange-search').value.toLowerCase().trim();
                const monthFilter = document.getElementById('arrange-month-filter').value;
                const tableBody = document.getElementById('arrange-table-body');
                
                const filteredData = arrangedData.filter(record => {
                    if (monthFilter && !record.date.startsWith(monthFilter)) {
                        return false;
                    }
                    
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm) ||
                            record.dean.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                        <td>暂无匹配的整理数据</td>
                        </tr>
                    `;
                    return;
                }

                let html = '';
                filteredData.forEach(record => {
                    html += `
                        <tr>
                        <td>${record.id}</td>
                        <td>${record.name}</td>
                        <td>${record.department}</td>
                        <td>${record.status}</td>
                        <td>${record.dean}</td>
                        <td>${record.date}</td>
                        <td>${record.time1 || ''}</td>
                        <td>${record.time2 || ''}</td>
                        <td>${record.time3 || ''}</td>
                        <td>${record.time4 || ''}</td>
                        <td title="${record.ruleIn}">${record.ruleIn || ''}</td>
                        <td title="${record.ruleOut}">${record.ruleOut || ''}</td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            },
            
            editAttendance(recordId) {
                const attendanceData = DataStore.getAttendanceData();
                const record = attendanceData.find(r => r.recordId === recordId);
                
                if (record) {
                    document.getElementById('edit-attendance-record-id').value = record.recordId;
                    document.getElementById('edit-attendance-id').value = record.id;
                    document.getElementById('edit-attendance-name').value = record.name;
                    document.getElementById('edit-attendance-department').value = record.department;
                    document.getElementById('edit-attendance-status').value = record.status;
                    document.getElementById('edit-attendance-dean').value = record.dean;
                    document.getElementById('edit-attendance-date').value = record.date;
                    
                    for (let i = 1; i <= 10; i++) {
                        const timeValue = record[`time${i}`] || '';
                        document.getElementById(`edit-attendance-time${i}`).value = timeValue;
                    }
                    
                    document.getElementById('edit-attendance-modal').classList.add('show');
                }
            },
            
            updateAttendance() {
                const recordId = document.getElementById('edit-attendance-record-id').value;
                const date = document.getElementById('edit-attendance-date').value;
                
                if (!date) {
                    Notification.show('请选择日期', 'error');
                    return;
                }
                
                const timeData = {};
                for (let i = 1; i <= 10; i++) {
                    timeData[`time${i}`] = document.getElementById(`edit-attendance-time${i}`).value || '';
                }
                
                let attendanceData = DataStore.getAttendanceData();
                const index = attendanceData.findIndex(r => r.recordId === recordId);
                
                if (index !== -1) {
                    attendanceData[index] = {
                        ...attendanceData[index],
                        date,
                        ...timeData
                    };
                    
                    DataStore.saveAttendanceData(attendanceData);
                    
                    this.arrangeAttendanceData();
                    
                    this.renderAttendanceList();
                    this.renderArrangedData();
                    
                    ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                        DeanPage.renderDeanData(dean);
                    });
                    
                    document.getElementById('edit-attendance-modal').classList.add('show');
                    Notification.show('考勤信息更新成功', 'success');
                }
            },
            
            deleteAttendance(recordId) {
                if (confirm('确定要删除该考勤记录吗？')) {
                    let attendanceData = DataStore.getAttendanceData();
                    attendanceData = attendanceData.filter(r => r.recordId !== recordId);
                    DataStore.saveAttendanceData(attendanceData);
                    
                    let arrangedData = DataStore.getArrangedData();
                    arrangedData = arrangedData.filter(r => r.recordId !== recordId);
                    DataStore.saveArrangedData(arrangedData);
                    
                    this.renderAttendanceList();
                    this.renderArrangedData();
                    
                    ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                        DeanPage.renderDeanData(dean);
                    });
                    
                    Notification.show('考勤记录已删除', 'success');
                }
            },
            
            deleteAttendanceByStaffId(staffId) {
                let attendanceData = DataStore.getAttendanceData();
                attendanceData = attendanceData.filter(r => r.id !== staffId);
                DataStore.saveAttendanceData(attendanceData);
                
                let arrangedData = DataStore.getArrangedData();
                arrangedData = arrangedData.filter(r => r.id !== staffId);
                DataStore.saveArrangedData(arrangedData);
                
                this.renderAttendanceList();
                this.renderArrangedData();
                
                ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                    DeanPage.renderDeanData(dean);
                });
            },
            
            deleteAttendanceByMonth() {
                const month = document.getElementById('attendance-month-filter').value;
                if (!month) {
                    Notification.show('请先选择要删除的月份', 'error');
                    return;
                }
                
                if (confirm(`确定要删除${month}月份的所有考勤记录吗？`)) {
                    let attendanceData = DataStore.getAttendanceData();
                    const originalCount = attendanceData.length;
                    attendanceData = attendanceData.filter(r => !r.date.startsWith(month));
                    DataStore.saveAttendanceData(attendanceData);
                    
                    let arrangedData = DataStore.getArrangedData();
                    arrangedData = arrangedData.filter(r => !r.date.startsWith(month));
                    DataStore.saveArrangedData(arrangedData);
                    
                    const deletedCount = originalCount - attendanceData.length;
                    
                    this.renderAttendanceList();
                    this.renderArrangedData();
                    
                    ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                        DeanPage.renderDeanData(dean);
                    });
                    
                    Notification.show(`成功删除${month}月份${deletedCount}条考勤记录`, 'success');
                }
            },
            
            deleteArrangedByMonth() {
                const month = document.getElementById('arrange-month-filter').value;
                if (!month) {
                    Notification.show('请先选择要删除的月份', 'error');
                    return;
                }
                
                if (confirm(`确定要删除${month}月份的所有整理记录吗？考勤原始数据不会被删除`)) {
                    let arrangedData = DataStore.getArrangedData();
                    const originalCount = arrangedData.length;
                    arrangedData = arrangedData.filter(r => !r.date.startsWith(month));
                    DataStore.saveArrangedData(arrangedData);
                    
                    const deletedCount = originalCount - arrangedData.length;
                    
                    this.renderArrangedData();
                    
                    ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                        DeanPage.renderDeanData(dean);
                    });
                    
                    Notification.show(`成功删除${month}月份${deletedCount}条整理记录`, 'success');
                }
            },
            
            updateStaffInfoInAttendance(staffId, name, department, status, dean) {
                let attendanceData = DataStore.getAttendanceData();
                attendanceData = attendanceData.map(record => {
                    if (record.id === staffId) {
                        return {
                            ...record,
                            name,
                            department,
                            status,
                            dean
                        };
                    }
                    return record;
                });
                DataStore.saveAttendanceData(attendanceData);
                
                let arrangedData = DataStore.getArrangedData();
                arrangedData = arrangedData.map(record => {
                    if (record.id === staffId) {
                        return {
                            ...record,
                            name,
                            department,
                            status,
                            dean
                        };
                    }
                    return record;
                });
                DataStore.saveArrangedData(arrangedData);
                
                this.renderAttendanceList();
                this.renderArrangedData();
                
                ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(deanName => {
                    DeanPage.renderDeanData(deanName);
                });
            },
            
            exportAttendanceExcel() {
                const attendanceData = DataStore.getAttendanceData();
                const searchTerm = document.getElementById('attendance-search').value.toLowerCase().trim();
                const monthFilter = document.getElementById('attendance-month-filter').value;
                
                const filteredData = attendanceData.filter(record => {
                    if (monthFilter && !record.date.startsWith(monthFilter)) {
                        return false;
                    }
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm) ||
                            record.dean.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    Notification.show('暂无匹配的考勤数据可导出', 'warning');
                    return;
                }
                
                const exportData = filteredData.map(record => {
                    return {
                        '工号': record.id,
                        '姓名': record.name,
                        '科室': record.department,
                        '状态': record.status,
                        '分管': record.dean,
                        '日期': record.date,
                        '考勤时间 1': record.time1 || '',
                        '考勤时间 2': record.time2 || '',
                        '考勤时间 3': record.time3 || '',
                        '考勤时间 4': record.time4 || '',
                        '考勤时间 5': record.time5 || '',
                        '考勤时间 6': record.time6 || '',
                        '考勤时间 7': record.time7 || '',
                        '考勤时间 8': record.time8 || '',
                        '考勤时间 9': record.time9 || '',
                        '考勤时间 10': record.time10 || ''
                    };
                });
                
                const worksheet = XLSX.utils.json_to_sheet(exportData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, '考勤信息');
                
                const fileName = `考勤信息表_${monthFilter || new Date().toLocaleDateString()}.xlsx`;
                XLSX.writeFile(workbook, fileName);
                Notification.show('考勤信息导出成功', 'success');
            },
            
            exportArrangedExcel() {
                const arrangedData = DataStore.getArrangedData();
                const searchTerm = document.getElementById('arrange-search').value.toLowerCase().trim();
                const monthFilter = document.getElementById('arrange-month-filter').value;
                
                const filteredData = arrangedData.filter(record => {
                    if (monthFilter && !record.date.startsWith(monthFilter)) {
                        return false;
                    }
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm) ||
                            record.dean.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    Notification.show('暂无匹配的整理数据可导出', 'warning');
                    return;
                }
                
                const exportData = filteredData.map(record => {
                    return {
                        '工号': record.id,
                        '姓名': record.name,
                        '科室': record.department,
                        '状态': record.status,
                        '分管': record.dean,
                        '日期': record.date,
                        '考勤时间 1': record.time1 || '',
                        '考勤时间 2': record.time2 || '',
                        '考勤时间 3': record.time3 || '',
                        '考勤时间 4': record.time4 || '',
                        '规则内考勤': record.ruleIn || '',
                        '规则外考勤': record.ruleOut || ''
                    };
                });
                
                const worksheet = XLSX.utils.json_to_sheet(exportData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, '整理后考勤信息');
                
                const fileName = `整理后考勤信息表_${monthFilter || new Date().toLocaleDateString()}.xlsx`;
                XLSX.writeFile(workbook, fileName);
                Notification.show('整理后考勤信息导出成功', 'success');
            }
        };

        const DeanPage = {
            renderDeanData(deanName) {
                const arrangedData = DataStore.getArrangedData();
                const deanPage = document.getElementById(`dean-${deanName}`);
                const searchInput = deanPage.querySelector('.dean-search');
                const monthFilter = deanPage.querySelector('.dean-month-filter').value;
                const tableBody = deanPage.querySelector('.dean-table-body');
                const searchTerm = searchInput.value.toLowerCase().trim();
                
                const filteredData = arrangedData.filter(record => {
                    if (record.dean !== deanName) return false;
                    if (monthFilter && !record.date.startsWith(monthFilter)) return false;
                    
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    tableBody.innerHTML = `
                        <tr class="text-center">
                        <td colspan="11" class="px-4 py-8 text-gray-500">暂无相关考勤数据</td>
                        </tr>
                    `;
                    return;
                }
                
                let html = '';
                filteredData.forEach(record => {
                    html += `
                        <tr>
                        <td>${record.id}</td>
                        <td>${record.name}</td>
                        <td>${record.department}</td>
                        <td>${record.status}</td>
                        <td>${record.date}</td>
                        <td>${record.time1 || ''}</td>
                        <td>${record.time2 || ''}</td>
                        <td>${record.time3 || ''}</td>
                        <td>${record.time4 || ''}</td>
                        <td title="${record.ruleIn}">${record.ruleIn || ''}</td>
                        <td title="${record.ruleOut}">${record.ruleOut || ''}</td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            },
            
            exportDeanExcel(deanName) {
                const arrangedData = DataStore.getArrangedData();
                const deanPage = document.getElementById(`dean-${deanName}`);
                const searchInput = deanPage.querySelector('.dean-search');
                const monthFilter = deanPage.querySelector('.dean-month-filter').value;
                const searchTerm = searchInput.value.toLowerCase().trim();
                
                const filteredData = arrangedData.filter(record => {
                    if (record.dean !== deanName) return false;
                    if (monthFilter && !record.date.startsWith(monthFilter)) return false;
                    
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    Notification.show('暂无相关考勤数据可导出', 'warning');
                    return;
                }
                
                const exportData = filteredData.map(record => {
                    return {
                        '工号': record.id,
                        '姓名': record.name,
                        '科室': record.department,
                        '状态': record.status,
                        '日期': record.date,
                        '考勤时间 1': record.time1 || '',
                        '考勤时间 2': record.time2 || '',
                        '考勤时间 3': record.time3 || '',
                        '考勤时间 4': record.time4 || '',
                        '规则内考勤': record.ruleIn || '',
                        '规则外考勤': record.ruleOut || ''
                    };
                });
                
                const worksheet = XLSX.utils.json_to_sheet(exportData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, `${deanName}分管考勤`);
                
                const fileName = `${deanName}分管考勤表_${monthFilter || new Date().toLocaleDateString()}.xlsx`;
                XLSX.writeFile(workbook, fileName);
                Notification.show(`${deanName}分管考勤表导出成功`, 'success');
            }
        };

        window.StaffManager = StaffManager;
        window.AttendanceManager = AttendanceManager;
        window.DeanPage = DeanPage;

        document.addEventListener('DOMContentLoaded', () => {
            PageSwitcher.init();
            StaffManager.init();
            AttendanceManager.init();
        });
        </script>
</body>
</html>



