<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>考勤管理系统</title>
    <script src="tailwindcss.js"></script>
    <script src="xlsx.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#6B7280',
                        success: '#00B42A',
                        danger: '#F53F3F',
                        warning: '#FF7D00',
                        info: '#86909C',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .table-fixed-layout {
                table-layout: fixed;
            }
            .text-ellipsis-1 {
                display: -webkit-box;
                /* -webkit-line-clamp: 1; */
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
            .scrollbar-thin {
                scrollbar-width: thin;
            }
            .scrollbar-thin::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            .scrollbar-thin::-webkit-scrollbar-thumb {
                background-color: rgba(156, 163, 175, 0.5);
                border-radius: 3px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 min-h-screen flex flex-col">
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-3">
            <ul class="flex flex-wrap space-x-1 md:space-x-4">
                <li><a href="#file-upload" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-primary border-b-2 border-primary">文件上传</a></li>
                <li><a href="#staff-upload" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-primary hover:bg-gray-50 transition-colors">职工信息上传</a></li>
                <li><a href="#attendance-show" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-primary hover:bg-gray-50 transition-colors">信息展示</a></li>
                <li><a href="#data-arrange" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-primary hover:bg-gray-50 transition-colors">数据整理记录</a></li>
                <li class="relative group">
                    <a href="#dean-pages" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-primary hover:bg-gray-50 transition-colors flex items-center">
                        分管页面
                        <i class="fa fa-chevron-down ml-1 text-xs transition-transform group-hover:rotate-180"></i>
                    </a>
                    <div class="absolute left-0 mt-1 w-48 bg-white rounded-md shadow-lg py-1 hidden group-hover:block z-50">
                        <a href="#dean-王雷" class="dean-link block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">王雷</a>
                        <a href="#dean-李春娟" class="dean-link block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">李春娟</a>
                        <a href="#dean-宋增信" class="dean-link block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">宋增信</a>
                        <a href="#dean-徐伟" class="dean-link block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">徐伟</a>
                        <a href="#dean-段海燕" class="dean-link block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">段海燕</a>
                        <a href="#dean-财务" class="dean-link block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">财务</a>
                    </div>
                </li>
            </ul>
        </nav>
    </header>

    <main class="flex-grow container mx-auto px-4 py-6">
        <section id="file-upload" class="page-section block">
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fa fa-upload text-primary mr-2"></i>考勤文件上传
                </h2>
                <div class="border border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary transition-colors cursor-pointer" id="drop-area">
                    <input type="file" id="attendance-file" class="hidden" accept=".txt,.xlsx,.csv">
                    <i class="fa fa-file-text-o text-4xl text-gray-400 mb-3"></i>
                    <p class="text-gray-500 mb-2">点击或拖拽文件至此处上传</p>
                    <p class="text-gray-400 text-sm">支持 .txt、.xlsx、.csv 格式文件</p>
                    <button type="button" id="select-file-btn" class="mt-4 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">
                        选择文件
                    </button>
                </div>
                <div id="file-info" class="mt-4 hidden">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-md">
                        <div class="flex items-center">
                            <i class="fa fa-file-text-o text-primary mr-2"></i>
                            <span id="file-name" class="text-gray-700 text-ellipsis-1 max-w-md"></span>
                        </div>
                        <button type="button" id="remove-file" class="text-danger hover:text-danger/80 transition-colors">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="mt-6 flex justify-end">
                    <button type="button" id="upload-confirm" class="px-6 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                        <i class="fa fa-check mr-2"></i>确认上传
                    </button>
                </div>
            </div>
        </section>

        <section id="staff-upload" class="page-section hidden">
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fa fa-user-plus text-primary mr-2"></i>职工信息上传
                </h2>
                <form id="staff-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="form-group">
                        <label for="staff-id" class="block text-sm font-medium text-gray-700 mb-1">工号 <span class="text-danger">*</span></label>
                        <input type="text" id="staff-id" name="staff-id" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" required>
                    </div>
                    <div class="form-group">
                        <label for="staff-name" class="block text-sm font-medium text-gray-700 mb-1">姓名 <span class="text-danger">*</span></label>
                        <input type="text" id="staff-name" name="staff-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" required>
                    </div>
                    <div class="form-group">
                        <label for="staff-department" class="block text-sm font-medium text-gray-700 mb-1">科室 <span class="text-danger">*</span></label>
                        <select id="staff-department" name="staff-department" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" required>
                            <option value="">请选择科室</option>
                            <option value="内科">内科</option>
                            <option value="外科">外科</option>
                            <option value="理疗科">理疗科</option>
                            <option value="护理">护理</option>
                            <option value="急诊科">急诊科</option>
                            <option value="妇产科">妇产科</option>
                            <option value="儿科">儿科</option>
                            <option value="放射科">放射科</option>
                            <option value="检验科">检验科</option>
                            <option value="药房">药房</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="staff-status" class="block text-sm font-medium text-gray-700 mb-1">状态 <span class="text-danger">*</span></label>
                        <select id="staff-status" name="staff-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" required>
                            <option value="">请选择状态</option>
                            <option value="正常">正常</option>
                            <option value="离退">离退</option>
                            <option value="外勤">外勤</option>
                            <option value="事假">事假</option>
                            <option value="病假">病假</option>
                            <option value="产假">产假</option>
                            <option value="年假">年假</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="staff-dean" class="block text-sm font-medium text-gray-700 mb-1">分管 <span class="text-danger">*</span></label>
                        <select id="staff-dean" name="staff-dean" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" required>
                            <option value="">请选择分管</option>
                            <option value="王雷">王雷</option>
                            <option value="李春娟">李春娟</option>
                            <option value="宋增信">宋增信</option>
                            <option value="徐伟">徐伟</option>
                            <option value="段海燕">段海燕</option>
                            <option value="财务">财务</option>
                        </select>
                    </div>
                    <div class="form-group flex items-end">
                        <button type="submit" class="w-full px-6 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center justify-center">
                            <i class="fa fa-save mr-2"></i>保存职工信息
                        </button>
                    </div>
                </form>
            </div>

            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3 md:mb-0">职工信息管理</h3>
                    <div class="flex flex-wrap gap-3">
                        <div class="relative">
                            <input type="text" id="staff-search" placeholder="搜索工号、姓名、科室、分管..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors w-full md:w-64">
                            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <label class="flex items-center px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 cursor-pointer transition-colors">
                            <i class="fa fa-upload text-primary mr-2"></i>
                            <span>批量上传</span>
                            <input type="file" id="staff-batch-upload" class="hidden" accept=".xlsx,.csv">
                        </label>
                        <button type="button" id="staff-clear-all" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors flex items-center">
                            <i class="fa fa-trash-o mr-2"></i>清空所有信息
                        </button>
                        <button type="button" id="staff-export" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto scrollbar-thin">
                    <table class="w-full table-fixed-layout border-collapse">
                        <thead>
                            <tr class="bg-gray-50 text-left">
                                <th class="px-4 py-3 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">工号</th>
                                <th class="px-4 py-3 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">姓名</th>
                                <th class="px-4 py-3 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">科室</th>
                                <th class="px-4 py-3 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">状态</th>
                                <th class="px-4 py-3 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">分管</th>
                                <th class="px-4 py-3 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">操作</th>
                            </tr>
                        </thead>
                        <tbody id="staff-table-body">
                            <tr class="text-center">
                                <td colspan="6" class="px-4 py-8 text-gray-500">暂无职工信息，请添加或上传数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- 3. 信息展示页面 -->
        <section id="attendance-show" class="page-section hidden">
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800 mb-3 md:mb-0 flex items-center">
                        <i class="fa fa-table text-primary mr-2"></i>考勤信息展示
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        <div class="relative">
                            <input type="text" id="attendance-search" placeholder="搜索日期、工号、姓名、科室、分管..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors w-full md:w-64">
                            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <div class="relative">
                            <input type="month" id="attendance-month-filter" class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                        </div>
                        <button type="button" id="attendance-export" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                        <button type="button" id="attendance-delete-month" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors flex items-center">
                            <i class="fa fa-trash-o mr-2"></i>删除指定月份
                        </button>
                        <button type="button" id="attendance-add-blank" class="px-4 py-2 bg-warning text-white rounded-md hover:bg-warning/90 transition-colors flex items-center">
                            <i class="fa fa-plus mr-2"></i>增加空白表
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto scrollbar-thin max-h-[70vh] overflow-y-auto">
                    <table class="w-full table-fixed-layout border-collapse">
                        <thead class="sticky top-0 bg-white z-10">
                            <tr class="text-left">
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">工号</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">姓名</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">科室</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">状态</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">分管</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">日期</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间1</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间2</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间3</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间4</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间5</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间6</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间7</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间8</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间9</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间10</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">操作</th>
                            </tr>
                        </thead>
                        <tbody id="attendance-table-body">
                            <tr class="text-center">
                                <td colspan="17" class="px-4 py-8 text-gray-500">暂无考勤信息，请添加空白表或上传考勤文件</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- 存在问题：页面显示问题，行分割线错乱，编辑和删除按钮放置不合理。 -->
        <section id="data-arrange" class="page-section hidden">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800 mb-3 md:mb-0 flex items-center">
                        <i class="fa fa-bar-chart text-primary mr-2"></i>数据整理记录表
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        <div class="relative">
                            <input type="text" id="arrange-search" placeholder="搜索日期、工号、姓名、科室、分管..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors w-full md:w-64">
                            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <div class="relative">
                            <input type="month" id="arrange-month-filter" class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors hidden">
                        </div>
                        <button type="button" id="arrange-export" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                        <button type="button" id="arrange-delete-month" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors flex items-center hidden">
                            <i class="fa fa-trash-o mr-2"></i>删除指定月份
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto scrollbar-thin max-h-[70vh] overflow-y-auto">
                    <table class="w-full table-fixed-layout border-collapse">
                        <thead class="sticky top-0 bg-white z-10">
                            <tr class="text-left">
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">工号</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">姓名</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">科室</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">状态</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">分管</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">日期</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间1</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间2</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间3</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间4</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则内考勤</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则外考勤</th>
                                <!-- <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">操作</th> -->
                            </tr>
                        </thead>
                        <tbody id="arrange-table-body">
                            <tr class="text-center">
                                <td colspan="12" class="px-4 py-8 text-gray-500">暂无整理数据，请先上传考勤文件</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-王雷" class="page-section hidden dean-page" data-dean="王雷">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800 mb-3 md:mb-0 flex items-center">
                        <i class="fa fa-user-circle text-primary mr-2"></i>王雷 - 考勤记录表
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        <div class="relative">
                            <input type="text" class="dean-search pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors w-full md:w-64" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                        </div>
                        <button type="button" class="dean-export px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto scrollbar-thin max-h-[70vh] overflow-y-auto">
                    <table class="w-full table-fixed-layout border-collapse">
                        <thead class="sticky top-0 bg-white z-10">
                            <tr class="text-left">
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">工号</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">姓名</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">科室</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">状态</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">日期</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间1</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间2</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间3</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间4</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则内考勤</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="text-center">
                                <td colspan="11" class="px-4 py-8 text-gray-500">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-李春娟" class="page-section hidden dean-page" data-dean="李春娟">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800 mb-3 md:mb-0 flex items-center">
                        <i class="fa fa-user-circle text-primary mr-2"></i>李春娟 - 考勤记录表
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        <div class="relative">
                            <input type="text" class="dean-search pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors w-full md:w-64" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                        </div>
                        <button type="button" class="dean-export px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto scrollbar-thin max-h-[70vh] overflow-y-auto">
                    <table class="w-full table-fixed-layout border-collapse">
                        <thead class="sticky top-0 bg-white z-10">
                            <tr class="text-left">
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">工号</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">姓名</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">科室</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">状态</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">日期</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间1</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间2</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间3</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间4</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则内考勤</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="text-center">
                                <td colspan="11" class="px-4 py-8 text-gray-500">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-宋增信" class="page-section hidden dean-page" data-dean="宋增信">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800 mb-3 md:mb-0 flex items-center">
                        <i class="fa fa-user-circle text-primary mr-2"></i>宋增信 - 考勤记录表
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        <div class="relative">
                            <input type="text" class="dean-search pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors w-full md:w-64" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                        </div>
                        <button type="button" class="dean-export px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto scrollbar-thin max-h-[70vh] overflow-y-auto">
                    <table class="w-full table-fixed-layout border-collapse">
                        <thead class="sticky top-0 bg-white z-10">
                            <tr class="text-left">
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">工号</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">姓名</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">科室</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">状态</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">日期</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间1</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间2</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间3</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间4</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则内考勤</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="text-center">
                                <td colspan="11" class="px-4 py-8 text-gray-500">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-徐伟" class="page-section hidden dean-page" data-dean="徐伟">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800 mb-3 md:mb-0 flex items-center">
                        <i class="fa fa-user-circle text-primary mr-2"></i>徐伟 - 考勤记录表
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        <div class="relative">
                            <input type="text" class="dean-search pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors w-full md:w-64" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                        </div>
                        <button type="button" class="dean-export px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto scrollbar-thin max-h-[70vh] overflow-y-auto">
                    <table class="w-full table-fixed-layout border-collapse">
                        <thead class="sticky top-0 bg-white z-10">
                            <tr class="text-left">
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">工号</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">姓名</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">科室</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">状态</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">日期</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间1</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间2</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间3</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间4</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则内考勤</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="text-center">
                                <td colspan="11" class="px-4 py-8 text-gray-500">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-段海燕" class="page-section hidden dean-page" data-dean="段海燕">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800 mb-3 md:mb-0 flex items-center">
                        <i class="fa fa-user-circle text-primary mr-2"></i>段海燕 - 考勤记录表
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        <div class="relative">
                            <input type="text" class="dean-search pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors w-full md:w-64" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                        </div>
                        <button type="button" class="dean-export px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto scrollbar-thin max-h-[70vh] overflow-y-auto">
                    <table class="w-full table-fixed-layout border-collapse">
                        <thead class="sticky top-0 bg-white z-10">
                            <tr class="text-left">
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">工号</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">姓名</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">科室</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">状态</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">日期</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间1</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间2</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间3</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间4</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则内考勤</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="text-center">
                                <td colspan="11" class="px-4 py-8 text-gray-500">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="dean-财务" class="page-section hidden dean-page" data-dean="财务">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800 mb-3 md:mb-0 flex items-center">
                        <i class="fa fa-user-circle text-primary mr-2"></i>财务 - 考勤记录表
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        <div class="relative">
                            <input type="text" class="dean-search pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors w-full md:w-64" placeholder="搜索日期、工号、姓名、科室...">
                            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <div class="relative">
                            <input type="month" class="dean-month-filter px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                        </div>
                        <button type="button" class="dean-export px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                            <i class="fa fa-download mr-2"></i>导出Excel
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto scrollbar-thin max-h-[70vh] overflow-y-auto">
                    <table class="w-full table-fixed-layout border-collapse">
                        <thead class="sticky top-0 bg-white z-10">
                            <tr class="text-left">
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">工号</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">姓名</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">科室</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-16">状态</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-24">日期</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间1</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间2</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间3</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-20">考勤时间4</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则内考勤</th>
                                <th class="px-3 py-2 text-sm font-semibold text-gray-700 border-b border-gray-200 w-32">规则外考勤</th>
                            </tr>
                        </thead>
                        <tbody class="dean-table-body">
                            <tr class="text-center">
                                <td colspan="11" class="px-4 py-8 text-gray-500">暂无相关考勤数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <div id="notification" class="fixed top-20 right-4 max-w-md p-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 flex items-center z-50 hidden">
        <i id="notification-icon" class="mr-3 text-xl"></i>
        <div id="notification-message" class="text-sm font-medium"></div>
    </div>

    <div id="edit-staff-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">编辑职工信息</h3>
                <button type="button" id="close-edit-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <form id="edit-staff-form" class="grid grid-cols-1 gap-4">
                <input type="hidden" id="edit-staff-id">
                <div class="form-group">
                    <label for="edit-staff-name" class="block text-sm font-medium text-gray-700 mb-1">姓名 <span class="text-danger">*</span></label>
                    <input type="text" id="edit-staff-name" name="edit-staff-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" required>
                </div>
                <div class="form-group">
                    <label for="edit-staff-department" class="block text-sm font-medium text-gray-700 mb-1">科室 <span class="text-danger">*</span></label>
                    <select id="edit-staff-department" name="edit-staff-department" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" required>
                        <option value="">请选择科室</option>
                        <option value="内科">内科</option>
                        <option value="外科">外科</option>
                        <option value="理疗">理疗</option>
                        <option value="护理">护理</option>
                        <option value="妇儿">妇儿</option>
                        <option value="公卫">公卫</option>
                        <option value="药房">药房</option>
                        <option value="防疫">防疫</option>
                        <option value="B超">B超</option>
                        <option value="放射">放射</option>
                        <option value="财务">财务</option>
                        <option value="化验">化验</option>
                        <option value="收费">收费</option>
                        <option value="口腔">口腔</option>
                        <option value="办公室">办公室</option>
                        <option value="居民医保">居民医保</option>
                        <option value="药库">药库</option>
                        <option value="后勤">后勤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-staff-status" class="block text-sm font-medium text-gray-700 mb-1">状态 <span class="text-danger">*</span></label>
                    <select id="edit-staff-status" name="edit-staff-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" required>
                        <option value="">请选择状态</option>
                        <option value="正常">正常</option>
                        <option value="离退">离退</option>
                        <option value="外勤">外勤</option>
                        <option value="事假">事假</option>
                        <option value="病假">病假</option>
                        <option value="产假">产假</option>
                        <option value="年假">年假</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-staff-dean" class="block text-sm font-medium text-gray-700 mb-1">分管 <span class="text-danger">*</span></label>
                    <select id="edit-staff-dean" name="edit-staff-dean" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" required>
                        <option value="">请选择分管</option>
                        <option value="王雷">王雷</option>
                        <option value="李春娟">李春娟</option>
                        <option value="宋增信">宋增信</option>
                        <option value="徐伟">徐伟</option>
                        <option value="段海燕">段海燕</option>
                        <option value="财务">财务</option>
                    </select>
                </div>
                <div class="form-group flex gap-3">
                    <button type="button" id="cancel-edit" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">取消</button>
                    <button type="submit" class="flex-1 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">保存修改</button>
                </div>
            </form>
        </div>
    </div>

    <div id="edit-attendance-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">编辑考勤信息</h3>
                <button type="button" id="close-attendance-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <form id="edit-attendance-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" id="edit-attendance-record-id">
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-700 mb-1">工号</label>
                    <input type="text" id="edit-attendance-id" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" readonly>
                </div>
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-700 mb-1">姓名</label>
                    <input type="text" id="edit-attendance-name" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" readonly>
                </div>
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-700 mb-1">科室</label>
                    <input type="text" id="edit-attendance-department" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" readonly>
                </div>
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-700 mb-1">分管</label>
                    <input type="text" id="edit-attendance-dean" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" readonly>
                </div>
                <div class="form-group">
                    <label for="edit-attendance-date" class="block text-sm font-medium text-gray-700 mb-1">日期 <span class="text-danger">*</span></label>
                    <input type="date" id="edit-attendance-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" required>
                </div>
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-700 mb-1">状态</label>
                    <input type="text" id="edit-attendance-status" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" readonly>
                </div>
                
                <div class="form-group md:col-span-2 grid grid-cols-2 md:grid-cols-5 gap-3">
                    <div>
                        <label for="edit-attendance-time1" class="block text-xs font-medium text-gray-700 mb-1">考勤时间1</label>
                        <input type="time" id="edit-attendance-time1" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                    </div>
                    <div>
                        <label for="edit-attendance-time2" class="block text-xs font-medium text-gray-700 mb-1">考勤时间2</label>
                        <input type="time" id="edit-attendance-time2" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                    </div>
                    <div>
                        <label for="edit-attendance-time3" class="block text-xs font-medium text-gray-700 mb-1">考勤时间3</label>
                        <input type="time" id="edit-attendance-time3" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                    </div>
                    <div>
                        <label for="edit-attendance-time4" class="block text-xs font-medium text-gray-700 mb-1">考勤时间4</label>
                        <input type="time" id="edit-attendance-time4" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                    </div>
                    <div>
                        <label for="edit-attendance-time5" class="block text-xs font-medium text-gray-700 mb-1">考勤时间5</label>
                        <input type="time" id="edit-attendance-time5" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                    </div>
                </div>
                
                <div class="form-group md:col-span-2 grid grid-cols-2 md:grid-cols-5 gap-3">
                    <div>
                        <label for="edit-attendance-time6" class="block text-xs font-medium text-gray-700 mb-1">考勤时间6</label>
                        <input type="time" id="edit-attendance-time6" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                    </div>
                    <div>
                        <label for="edit-attendance-time7" class="block text-xs font-medium text-gray-700 mb-1">考勤时间7</label>
                        <input type="time" id="edit-attendance-time7" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                    </div>
                    <div>
                        <label for="edit-attendance-time8" class="block text-xs font-medium text-gray-700 mb-1">考勤时间8</label>
                        <input type="time" id="edit-attendance-time8" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                    </div>
                    <div>
                        <label for="edit-attendance-time9" class="block text-xs font-medium text-gray-700 mb-1">考勤时间9</label>
                        <input type="time" id="edit-attendance-time9" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                    </div>
                    <div>
                        <label for="edit-attendance-time10" class="block text-xs font-medium text-gray-700 mb-1">考勤时间10</label>
                        <input type="time" id="edit-attendance-time10" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                    </div>
                </div>
                
                <div class="form-group md:col-span-2 flex gap-3 justify-end">
                    <button type="button" id="cancel-attendance-edit" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">取消</button>
                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">保存修改</button>
                </div>
            </form>
        </div>
    </div>

    <footer class="bg-white border-t border-gray-200 py-4 mt-8">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>© 2026 考勤管理系统 | 打造智能考勤，赋能高效管理</p>
            <p>保留所有权利 | 技术维护：信息科</a></p>
        </div>
    </footer>

    <script>
        // 数据存储模块
        const DataStore = {
            // 职工信息
            getStaffData() {
                const data = localStorage.getItem('staffData');
                return data ? JSON.parse(data) : [];
            },
            
            saveStaffData(data) {
                localStorage.setItem('staffData', JSON.stringify(data));
            },
            
            // 考勤信息
            getAttendanceData() {
                const data = localStorage.getItem('attendanceData');
                return data ? JSON.parse(data) : [];
            },
            
            saveAttendanceData(data) {
                localStorage.setItem('attendanceData', JSON.stringify(data));
            },
            
            // 整理后的考勤数据
            getArrangedData() {
                const data = localStorage.getItem('arrangedData');
                return data ? JSON.parse(data) : [];
            },
            
            saveArrangedData(data) {
                localStorage.setItem('arrangedData', JSON.stringify(data));
            },
            
            // 生成唯一ID
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
            }
        };

        // 存在问题：显示后不消失
        // 通知模块
        // const Notification = {
        //     show(message, type = 'success') {
        //         const notification = document.getElementById('notification');
        //         const icon = document.getElementById('notification-icon');
        //         const messageEl = document.getElementById('notification-message');
                
        //         // 设置消息和图标
        //         messageEl.textContent = message;
                
        //         // 设置样式
        //         notification.className = 'fixed top-20 right-4 max-w-md p-4 rounded-lg shadow-lg transform translate-x-0 transition-transform duration-300 flex items-center z-50';
                
        //         if (type === 'success') {
        //             notification.classList.add('bg-success', 'text-white');
        //             icon.className = 'mr-3 text-xl fa fa-check-circle';
        //         } else if (type === 'error') {
        //             notification.classList.add('bg-danger', 'text-white');
        //             icon.className = 'mr-3 text-xl fa fa-exclamation-circle';
        //         } else if (type === 'warning') {
        //             notification.classList.add('bg-warning', 'text-white');
        //             icon.className = 'mr-3 text-xl fa fa-exclamation-triangle';
        //         } else if (type === 'info') {
        //             notification.classList.add('bg-primary', 'text-white');
        //             icon.className = 'mr-3 text-xl fa fa-info-circle';
        //         }
                
        //         setTimeout (() => {
        //             notification.classList.add ('translate-x-full');
        //         }, 2000);
        //     }
        // };

        // 问题已修复
        // 第二步：完善的通知模块逻辑
        const Notification = {
            // 显示通知
            show(message, type = 'success') {
                const notification = document.getElementById('notification');
                const icon = document.getElementById('notification-icon');
                const messageEl = document.getElementById('notification-message');

                // 清空原有样式和内容
                notification.className = 'fixed top-20 right-4 max-w-md p-4 rounded-lg shadow-lg transform transition-transform duration-300 flex items-center z-50';
                icon.className = '';
            
                // 设置消息内容
                messageEl.textContent = message;

                // 根据类型设置样式和图标
                switch(type) {
                    case 'success':
                        // notification.classList.add('bg-success', 'text-white');
                        // icon.className = 'mr-3 text-xl fa fa-check-circle';
                        // break;
                        notification.style.backgroundColor = '#4CAF50';
                        notification.style.color = '#fff';
                        // icon.className = 'mr-3 text-xl fa fa-check-circle';
                        break;
                    case 'error':
                        notification.classList.add('bg-danger', 'text-white');
                        icon.className = 'mr-3 text-xl fa fa-exclamation-circle';
                        break;
                    case 'warning':
                        notification.classList.add('bg-warning', 'text-white');
                        icon.className = 'mr-3 text-xl fa fa-exclamation-triangle';
                        break;
                    case 'info':
                        notification.classList.add('bg-primary', 'text-white');
                        icon.className = 'mr-3 text-xl fa fa-info-circle';
                        break;
                    default:
                        notification.classList.add('bg-primary', 'text-white');
                        icon.className = 'mr-3 text-xl fa fa-info-circle';
                    }

                // 显示通知（移除hidden并重置位移）
                notification.classList.remove('translate-x-full', 'hidden');
                notification.classList.add('translate-x-0');

                // 自动关闭通知
                setTimeout(() => {
                    notification.classList.remove('translate-x-0');
                    notification.classList.add('translate-x-full');
                // 延迟后隐藏DOM，避免遮挡点击
                    setTimeout(() => {
                        notification.classList.add('hidden');
                    }, 300);
                }, 3000);
            },
        };

        // 页面切换模块
        const PageSwitcher = {
            init() {
                // 导航链接点击事件
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('href');
                        this.showPage(targetId);
                        
                        // 更新导航样式
                        document.querySelectorAll('.nav-link').forEach(item => {
                            item.classList.remove('text-primary', 'border-b-2', 'border-primary');
                            item.classList.add('text-gray-600');
                        });
                        link.classList.add('text-primary', 'border-b-2', 'border-primary');
                        link.classList.remove('text-gray-600');
                    });
                });
                
                // 分管链接点击事件
                document.querySelectorAll('.dean-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('href');
                        this.showPage(targetId);
                    
                        // 更新导航样式
                        document.querySelectorAll('.nav-link').forEach(item => {
                            item.classList.remove('text-primary', 'border-b-2', 'border-primary');
                            item.classList.add('text-gray-600');
                        });
                        document.querySelector('a[href="#dean-pages"]').classList.add('text-primary', 'border-b-2', 'border-primary');
                        document.querySelector('a[href="#dean-pages"]').classList.remove('text-gray-600');
                    });
                });
                
                // 默认显示第一个页面
                this.showPage('#file-upload');
            },
            
            showPage(pageId) {
                // 隐藏所有页面
                document.querySelectorAll('.page-section').forEach(section => {
                    section.classList.add('hidden');
                    section.classList.remove('block');
                });
                
                // 显示目标页面
                const targetPage = document.querySelector(pageId);
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                    targetPage.classList.add('block');
                    
                    // 如果是分管页面，刷新对应数据
                    if (pageId.startsWith('#dean-')) {
                        const deanName = pageId.replace('#dean-', '');
                        DeanPage.renderDeanData(deanName);
                    }
                }
            }
        };

        // 文件处理模块
        const FileHandler = {
            // 解析 TXT 文件
            parseTxtFile(content) {
                try {
                    // 步骤1：优化文本清理（移除首尾空白、多余换行/回车，清理开头无效字符）
                    content = content.trim()
                        .replace(/^\s*Return\s*/, '') // 移除开头的 Return（含前后空白）
                        .replace(/\r\n|\r|\n/g, ' '); // 换行符替换为空格，避免跨行匹配问题
                    
                    // 步骤2：优化正则（移除末尾的 [^)]+，只匹配核心字段，兼容任意后缀）
                    // 核心匹配：time="xxx" 后面跟任意空白，再 id="xxx"，再任意空白，再 name="xxx"
                    const timeRegex = /time="([^"]+)"\s+id="([^"]+)"\s+name="([^"]+)"/g;
                    const results = [];
                    let match;
                    
                    // 步骤3：循环匹配（全局正则的 exec 会自动更新 lastIndex，遍历所有匹配）
                    while ((match = timeRegex.exec(content)) !== null) {
                        const [, datetime, id, name] = match;
                        // 兼容 datetime 无空格的情况（如 "2024-01-0108:00"）
                        const [date, time] = datetime.includes(' ') 
                            ? datetime.split(' ') 
                            : [datetime.slice(0, 10), datetime.slice(10)];
                        
                        results.push({ date, time, id, name });
                    }

                    // 兜底：无匹配结果时提示
                    if (results.length === 0) {
                        Notification.show('未解析到任何考勤记录，请检查文件格式', 'warning');
                    }
                    
                    return results;
                } catch (error) {
                    console.error('解析 TXT 文件失败:', error);
                    Notification.show('解析 TXT 文件失败，请检查文件格式', 'error');
                    return [];
                }
            },
            
            // 解析 Excel/CSV 文件
            parseExcelFile(workbook) {
                try {
                    // 获取第一个工作表
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    
                    // 转换为 JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // 处理不同格式（可能的表头变体）
                    const results = jsonData.map(item => {
                        // 兼容不同的表头命名
                        const date = item['日期'] || item['date'] || '';
                        const time = item['时间'] || item['time'] || '';
                        const id = item['工号'] || item['id'] || item['ID'] || '';
                        const name = item['姓名'] || item['name'] || '';
                        return { date, time, id: id.toString(), name };
                    }).filter(item => item.date && item.time && item.id && item.name);
                    
                    return results;
                } catch (error) {
                    console.error('解析 Excel 文件失败:', error);
                    Notification.show('解析 Excel 文件失败，请检查文件格式', 'error');
                    return [];
                }
            },
            
            // 解析职工批量上传文件
            parseStaffFile(workbook) {
                try {
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    const results = jsonData.map(item => {
                        return {
                            id: (item['工号'] || item['id'] || '').toString().trim(),
                            name: (item['姓名'] || item['name'] || '').trim(),
                            department: (item['科室'] || item['department'] || '').trim(),
                            status: (item['状态'] || item['status'] || '').trim(),
                            dean: (item['分管'] || item['dean'] || item['分管院长'] || '').trim()
                        };
                    }).filter(item => item.id && item.name && item.department && item.status && item.dean);
                    
                    return results;
                } catch (error) {
                    console.error('解析职工文件失败:', error);
                    Notification.show('解析职工文件失败，请检查文件格式', 'error');
                    return [];
                }
            }
        };

        // 职工信息管理模块
        const StaffManager = {
            init() {
                // 渲染职工列表
                this.renderStaffList();
                
                // 职工表单提交
                document.getElementById('staff-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addStaff();
                });
                
                // 职工搜索
                document.getElementById('staff-search').addEventListener('input', () => {
                    this.renderStaffList();
                });
                
                // 批量上传
                document.getElementById('staff-batch-upload').addEventListener('change', (e) => {
                    this.batchUploadStaff(e.target.files[0]);
                });
                
                // 清空所有
                document.getElementById('staff-clear-all').addEventListener('click', () => {
                    if (confirm('确定要清空所有职工信息吗？此操作不可恢复！')) {
                        DataStore.saveStaffData([]);
                        this.renderStaffList();
                        Notification.show('所有职工信息已清空', 'warning');
                    }
                });
                
                // 导出 Excel
                document.getElementById('staff-export').addEventListener('click', () => {
                    this.exportStaffExcel();
                });
                
                // 编辑模态框关闭
                document.getElementById('close-edit-modal').addEventListener('click', () => {
                    document.getElementById('edit-staff-modal').classList.add('hidden');
                });
                document.getElementById('cancel-edit').addEventListener('click', () => {
                    document.getElementById('edit-staff-modal').classList.add('hidden');
                });
                
                // 编辑表单提交
                document.getElementById('edit-staff-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateStaff();
                });
            },
            
            // 添加职工
            addStaff() {
                const id = document.getElementById('staff-id').value.trim();
                const name = document.getElementById('staff-name').value.trim();
                const department = document.getElementById('staff-department').value;
                const status = document.getElementById('staff-status').value;
                const dean = document.getElementById('staff-dean').value;
                
                // 验证
                if (!id || !name || !department || !status || !dean) {
                    Notification.show('请填写完整的职工信息', 'error');
                    return;
                }
                
                const staffData = DataStore.getStaffData();
                
                // 检查工号是否已存在
                const exists = staffData.some(staff => staff.id === id);
                if (exists) {
                    Notification.show(`工号${id}已存在，请检查输入信息`, 'error');
                    return;
                }
                
                // 添加新职工
                const newStaff = {
                    id,
                    name,
                    department,
                    status,
                    dean,
                    createTime: new Date().toISOString()
                };
                
                staffData.push(newStaff);
                DataStore.saveStaffData(staffData);
                
                // 重置表单
                document.getElementById('staff-form').reset();
                
                // 刷新列表
                this.renderStaffList();
                Notification.show(`保存成功1条职工信息`, 'success');
            },
            
            // 批量上传职工
            batchUploadStaff(file) {
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const staffList = FileHandler.parseStaffFile(workbook);
                        
                        if (staffList.length === 0) {
                            Notification.show('未解析到有效职工数据', 'warning');
                            return;
                        }
                        
                        const existingStaff = DataStore.getStaffData();
                        const newStaffList = [...existingStaff];
                        let successCount = 0;
                        let duplicateCount = 0;
                        
                        staffList.forEach(staff => {
                            const exists = newStaffList.some(s => s.id === staff.id);
                            if (!exists) {
                                newStaffList.push({
                                    ...staff,
                                    createTime: new Date().toISOString()
                                });
                                successCount++;
                            } else {
                                duplicateCount++;
                            }
                        });
                        
                        DataStore.saveStaffData(newStaffList);
                        StaffManager.renderStaffList();
                        
                        let message = `批量上传成功！新增${successCount}条职工信息`;
                        if (duplicateCount > 0) {
                            message += `，跳过${duplicateCount}条重复工号数据`;
                        }
                        Notification.show(message, 'success');
                    } catch (error) {
                        console.error('批量上传职工失败:', error);
                        Notification.show('批量上传职工失败，请检查文件格式', 'error');
                    }
                };
                reader.readAsArrayBuffer(file);
            },
            
            // 更新职工信息
            updateStaff() {
                const id = document.getElementById('edit-staff-id').value;
                const name = document.getElementById('edit-staff-name').value.trim();
                const department = document.getElementById('edit-staff-department').value;
                const status = document.getElementById('edit-staff-status').value;
                const dean = document.getElementById('edit-staff-dean').value;
                
                if (!name || !department || !status || !dean) {
                    Notification.show('请填写完整的职工信息', 'error');
                    return;
                }
                
                const staffData = DataStore.getStaffData();
                const index = staffData.findIndex(staff => staff.id === id);
                
                if (index !== -1) {
                    staffData[index] = {
                        ...staffData[index],
                        name,
                        department,
                        status,
                        dean,
                        updateTime: new Date().toISOString()
                    };
                    
                    DataStore.saveStaffData(staffData);
                    this.renderStaffList();
                    document.getElementById('edit-staff-modal').classList.add('hidden');
                    
                    // 同时更新考勤数据中的相关信息
                    AttendanceManager.updateStaffInfoInAttendance(id, name, department, status, dean);
                    Notification.show('职工信息更新成功', 'success');
                }
            },
            
            // 删除职工
            deleteStaff(id) {
                if (confirm('确定要删除该职工信息吗？相关考勤数据也会被删除！')) {
                    let staffData = DataStore.getStaffData();
                    staffData = staffData.filter(staff => staff.id !== id);
                    DataStore.saveStaffData(staffData);
                    
                    // 删除相关考勤数据
                    AttendanceManager.deleteAttendanceByStaffId(id);
                    this.renderStaffList();
                    Notification.show('职工信息已删除', 'success');
                }
            },
            
            // 编辑职工
            editStaff(id) {
                const staffData = DataStore.getStaffData();
                const staff = staffData.find(s => s.id === id);
                
                if (staff) {
                    document.getElementById('edit-staff-id').value = staff.id;
                    document.getElementById('edit-staff-name').value = staff.name;
                    document.getElementById('edit-staff-department').value = staff.department;
                    document.getElementById('edit-staff-status').value = staff.status;
                    document.getElementById('edit-staff-dean').value = staff.dean;
                    document.getElementById('edit-staff-modal').classList.remove('hidden');
                }
            },
            
            // 渲染职工列表
            renderStaffList() {
                const staffData = DataStore.getStaffData();
                const searchTerm = document.getElementById('staff-search').value.toLowerCase().trim();
                const tableBody = document.getElementById('staff-table-body');
                
                // 筛选数据
                const filteredData = staffData.filter(staff => {
                    return staff.id.toLowerCase().includes(searchTerm) ||
                            staff.name.toLowerCase().includes(searchTerm) ||
                            staff.department.toLowerCase().includes(searchTerm) ||
                            staff.dean.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    tableBody.innerHTML = `
                        <tr class="text-center">
                        <td colspan="6" class="px-4 py-8 text-gray-500">暂无匹配的职工信息</td>
                        </tr>
                    `;
                    return;
                }
                
                // 生成表格内容
                let html = '';
                filteredData.forEach(staff => {
                    html += `
                        <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-4 py-3 border-b border-gray-200">${staff.id}</td>
                        <td class="px-4 py-3 border-b border-gray-200">${staff.name}</td>
                        <td class="px-4 py-3 border-b border-gray-200">${staff.department}</td>
                        <td class="px-4 py-3 border-b border-gray-200">${staff.status}</td>
                        <td class="px-4 py-3 border-b border-gray-200">${staff.dean}</td>
                        <td class="px-4 py-3 border-b border-gray-200">
                            <button onclick="StaffManager.editStaff('${staff.id}')" class="text-primary hover:text-primary/80 mr-3 transition-colors">
                            <i class="fa fa-pencil"></i> 编辑
                            </button>
                            <button onclick="StaffManager.deleteStaff('${staff.id}')" class="text-danger hover:text-danger/80 transition-colors">
                            <i class="fa fa-trash"></i> 删除
                            </button>
                        </td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            },
            
            // 导出职工 Excel
            exportStaffExcel() {
                const staffData = DataStore.getStaffData();
                if (staffData.length === 0) {
                    Notification.show('暂无职工数据可导出', 'warning');
                    return;
                }
                
                // 准备导出数据
                const exportData = staffData.map(staff => {
                    return {
                        '工号': staff.id,
                        '姓名': staff.name,
                        '科室': staff.department,
                        '状态': staff.status,
                        '分管': staff.dean
                    };
                });
                
                // 创建工作表和工作簿
                const worksheet = XLSX.utils.json_to_sheet(exportData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, '职工信息');
                
                // 导出文件
                XLSX.writeFile(workbook, `职工信息表_${new Date().toLocaleDateString()}.xlsx`);
                Notification.show('职工信息导出成功', 'success');
            },
            
            // 根据工号获取职工信息
            getStaffById(id) {
                const staffData = DataStore.getStaffData();
                return staffData.find(staff => staff.id === id) || null;
            }
        };

        // 考勤管理模块
        const AttendanceManager = {
            init() {
                // 渲染考勤列表
                this.renderAttendanceList();
                
                // 渲染整理后的数据
                this.renderArrangedData();
                
                // 考勤搜索
                document.getElementById('attendance-search').addEventListener('input', () => {
                    this.renderAttendanceList();
                });
                
                // 月份筛选
                document.getElementById('attendance-month-filter').addEventListener('change', () => {
                    this.renderAttendanceList();
                });
                
                // 导出 Excel
                document.getElementById('attendance-export').addEventListener('click', () => {
                    this.exportAttendanceExcel();
                });
                
                // 删除指定月份
                document.getElementById('attendance-delete-month').addEventListener('click', () => {
                    this.deleteAttendanceByMonth();
                });
                
                // 增加空白表
                document.getElementById('attendance-add-blank').addEventListener('click', () => {
                    this.addBlankAttendanceTable();
                });
                
                // 整理数据搜索
                document.getElementById('arrange-search').addEventListener('input', () => {
                    this.renderArrangedData();
                });
                
                // 整理数据月份筛选
                document.getElementById('arrange-month-filter').addEventListener('change', () => {
                    this.renderArrangedData();
                });
                
                // 整理数据导出
                document.getElementById('arrange-export').addEventListener('click', () => {
                    this.exportArrangedExcel();
                });
                
                // 整理数据删除月份
                document.getElementById('arrange-delete-month').addEventListener('click', () => {
                    this.deleteArrangedByMonth();
                });
                
                // 考勤文件上传相关
                document.getElementById('select-file-btn').addEventListener('click', () => {
                    document.getElementById('attendance-file').click();
                });
                
                // 文件选择
                document.getElementById('attendance-file').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        document.getElementById('file-name').textContent = file.name;
                        document.getElementById('file-info').classList.remove('hidden');
                    }
                });
                
                // 移除文件
                document.getElementById('remove-file').addEventListener('click', () => {
                    document.getElementById('attendance-file').value = '';
                    document.getElementById('file-info').classList.add('hidden');
                });
                
                // 确认上传
                document.getElementById('upload-confirm').addEventListener('click', () => {
                    this.uploadAttendanceFile();
                });
                
                // 拖放上传
                const dropArea = document.getElementById('drop-area');
                dropArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropArea.classList.add('border-primary', 'bg-primary/5');
                });
                dropArea.addEventListener('dragleave', () => {
                    dropArea.classList.remove('border-primary', 'bg-primary/5');
                });
                dropArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropArea.classList.remove('border-primary', 'bg-primary/5');
                    const file = e.dataTransfer.files[0];
                    if (file) {
                        document.getElementById('attendance-file').files = e.dataTransfer.files;
                        document.getElementById('file-name').textContent = file.name;
                        document.getElementById('file-info').classList.remove('hidden');
                    }
                });
                
                // 编辑考勤模态框关闭
                document.getElementById('close-attendance-modal').addEventListener('click', () => {
                    document.getElementById('edit-attendance-modal').classList.add('hidden');
                });
                document.getElementById('cancel-attendance-edit').addEventListener('click', () => {
                    document.getElementById('edit-attendance-modal').classList.add('hidden');
                });
                
                // 编辑考勤表单提交
                document.getElementById('edit-attendance-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateAttendance();
                });
                
                // 分管页面相关事件
                document.querySelectorAll('.dean-search').forEach(input => {
                    input.addEventListener('input', function() {
                        const deanPage = this.closest('.dean-page');
                        const deanName = deanPage.dataset.dean;
                        DeanPage.renderDeanData(deanName);
                    });
                });
                
                document.querySelectorAll('.dean-month-filter').forEach(input => {
                    input.addEventListener('change', function() {
                        const deanPage = this.closest('.dean-page');
                        const deanName = deanPage.dataset.dean;
                        DeanPage.renderDeanData(deanName);
                    });
                });
                
                document.querySelectorAll('.dean-export').forEach(button => {
                    button.addEventListener('click', function() {
                        const deanPage = this.closest('.dean-page');
                        const deanName = deanPage.dataset.dean;
                        DeanPage.exportDeanExcel(deanName);
                    });
                });
            },
            
            // 上传考勤文件
            uploadAttendanceFile() {
                const fileInput = document.getElementById('attendance-file');
                const file = fileInput.files[0];
                
                if (!file) {
                    Notification.show('请先选择要上传的文件', 'error');
                    return;
                }
                
                const reader = new FileReader();
                const fileName = file.name;
                const fileExtension = fileName.split('.').pop().toLowerCase();
                
                reader.onload = function(e) {
                    try {
                        let attendanceRecords;
                        
                        // 根据文件格式解析
                        if (fileExtension === 'txt') {
                            attendanceRecords = FileHandler.parseTxtFile(e.target.result);
                        } else if (['xlsx', 'csv'].includes(fileExtension)) {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            attendanceRecords = FileHandler.parseExcelFile(workbook);
                        } else {
                            Notification.show('不支持的文件格式', 'error');
                            return;
                        }
                        
                        if (attendanceRecords.length === 0) {
                            Notification.show('未解析到有效考勤数据', 'warning');
                            return;
                        }
                        
                        // 保存考勤数据
                        AttendanceManager.saveAttendanceRecords(attendanceRecords);
                        
                        // 重置文件输入
                        fileInput.value = '';
                        document.getElementById('file-info').classList.add('hidden');
                        Notification.show(`成功上传${attendanceRecords.length}条考勤记录`, 'success');
                    } catch (error) {
                        console.error('上传考勤文件失败:', error);
                        Notification.show('上传考勤文件失败，请重试', 'error');
                    }
                };
                
                if (fileExtension === 'txt') {
                    reader.readAsText(file, 'UTF-8');
                } else {
                    reader.readAsArrayBuffer(file);
                }
            },
            
            // 保存考勤记录
            saveAttendanceRecords(records) {
                let attendanceData = DataStore.getAttendanceData();
                
                records.forEach(record => {
                    const { date, time, id, name } = record;
                    const staffInfo = StaffManager.getStaffById(id) || {
                        name,
                        department: '未知',
                        status: '正常',
                        dean: '未知'
                    };
                    
                    // 查找是否已有相同工号、日期的记录
                    let existingRecordIndex = attendanceData.findIndex(item =>
                        item.id === id && item.date === date
                    );
                    
                    if (existingRecordIndex !== -1) {
                        // 已有记录，添加时间
                        const existingRecord = attendanceData[existingRecordIndex];
                        let timeAdded = false;
                        
                        // 找到第一个空的时间字段
                        for (let i = 1; i <= 10; i++) {
                            const timeField = `time${i}`;
                            if (!existingRecord[timeField] || existingRecord[timeField] === '') {
                                existingRecord[timeField] = time;
                                timeAdded = true;
                                break;
                            }
                        }
                        
                        // 如果所有时间字段都满了，不添加
                        if (!timeAdded) {
                            console.warn(`工号${id}在${date}的考勤时间已达10条上限，忽略后续记录`);
                        }
                    } else {
                        // 新记录
                        const newRecord = {
                            id,
                            name: staffInfo.name,
                            department: staffInfo.department,
                            status: staffInfo.status,
                            dean: staffInfo.dean,
                            date,
                            time1: time,
                            time2: '',
                            time3: '',
                            time4: '',
                            time5: '',
                            time6: '',
                            time7: '',
                            time8: '',
                            time9: '',
                            time10: '',
                            recordId: DataStore.generateId()
                        };
                        attendanceData.push(newRecord);
                    }
                });
                
                // 按工号、日期排序
                attendanceData.sort((a, b) => {
                    if (a.id !== b.id) return a.id.localeCompare(b.id);
                    return a.date.localeCompare(b.date);
                });
                
                // 保存数据
                DataStore.saveAttendanceData(attendanceData);
                
                // 重新整理数据
                this.arrangeAttendanceData();
                
                // 刷新页面
                this.renderAttendanceList();
                this.renderArrangedData();
                
                // 刷新所有分管页面
                ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                    DeanPage.renderDeanData(dean);
                });
            },
            
            // 整理考勤数据
            arrangeAttendanceData() {
                const attendanceData = DataStore.getAttendanceData();
                const arrangedData = [];
                
                attendanceData.forEach(record => {
                    const { id, name, department, status, dean, date } = record;
                    
                    // 收集所有非空时间
                    const allTimes = [];
                    for (let i = 1; i <= 10; i++) {
                        const time = record[`time${i}`];
                        if (time && time.trim() !== '') {
                            allTimes.push(time.trim());
                        }
                    }
                    
                    // 定义时间范围检查函数
                    const isInTimeRange = (time, start, end) => {
                        const timeStr = time.split(':').join('');
                        const startStr = start.split(':').join('');
                        const endStr = end.split(':').join('');
                        return timeStr >= startStr && timeStr <= endStr;
                    };
                    
                    // 按照规则筛选时间
                    let arranged = {
                        id,
                        name,
                        department,
                        status,
                        dean,
                        date,
                        time1: '',
                        time2: '',
                        time3: '',
                        time4: '',
                        ruleIn: [],
                        ruleOut: [],
                        recordId: record.recordId
                    };
                    
                    // 用于记录已分配的时间索引
                    const usedIndexes = new Set();
                    
                    // 规则 1: 05:00:00 - 09:00:00
                    for (let i = 0; i < allTimes.length; i++) {
                        const time = allTimes[i];
                        if (isInTimeRange(time, '05:00:00', '09:00:00')) {
                            arranged.time1 = time;
                            usedIndexes.add(i);
                            break;
                        }
                    }
                    
                    // 规则 2: 11:00:00-11:30:00 或 12:00:00-12:30:00
                    for (let i = 0; i < allTimes.length; i++) {
                        if (usedIndexes.has(i)) continue;
                        const time = allTimes[i];
                        if (isInTimeRange(time, '11:00:00', '11:30:00') ||
                            isInTimeRange(time, '12:00:00', '12:30:00')) {
                            arranged.time2 = time;
                            usedIndexes.add(i);
                            break;
                        }
                    }
                    
                    // 规则 3: 11:30:00-12:00:00 或 13:00:00-13:30:00
                    for (let i = 0; i < allTimes.length; i++) {
                        if (usedIndexes.has(i)) continue;
                        const time = allTimes[i];
                        if (isInTimeRange(time, '11:30:00', '12:00:00') ||
                            isInTimeRange(time, '13:00:00', '13:30:00')) {
                            arranged.time3 = time;
                            usedIndexes.add(i);
                            break;
                        }
                    }
                    
                    // 规则 4: 15:30:00-16:00:00 或 16:30:00-17:00:00
                    for (let i = 0; i < allTimes.length; i++) {
                        if (usedIndexes.has(i)) continue;
                        const time = allTimes[i];
                        if (isInTimeRange(time, '15:30:00', '16:00:00') ||
                            isInTimeRange(time, '16:30:00', '17:00:00')) {
                            arranged.time4 = time;
                            usedIndexes.add(i);
                            break;
                        }
                    }
                    
                    // 规则内考勤：符合任一规则但未被分配的时间
                    for (let i = 0; i < allTimes.length; i++) {
                        if (usedIndexes.has(i)) continue;
                        const time = allTimes[i];
                        
                        const isRule1 = isInTimeRange(time, '05:00:00', '09:00:00');
                        const isRule2 = isInTimeRange(time, '11:00:00', '11:30:00') || isInTimeRange(time, '12:00:00', '12:30:00');
                        const isRule3 = isInTimeRange(time, '11:30:00', '12:00:00') || isInTimeRange(time, '13:00:00', '13:30:00');
                        const isRule4 = isInTimeRange(time, '15:30:00', '16:00:00') || isInTimeRange(time, '16:30:00', '17:00:00');
                        
                        if (isRule1 || isRule2 || isRule3 || isRule4) {
                            arranged.ruleIn.push(time);
                        } else {
                            arranged.ruleOut.push(time);
                        }
                    }
                    
                    // 转换为字符串
                    arranged.ruleIn = arranged.ruleIn.join(', ');
                    arranged.ruleOut = arranged.ruleOut.join(', ');
                    arrangedData.push(arranged);
                });
                
                // 保存整理后的数据
                DataStore.saveArrangedData(arrangedData);
            },
            
            // 添加空白考勤表
            addBlankAttendanceTable() {
                const month = prompt('请输入要添加空白表的月份（格式：YYYY-MM）', '2025-01');
                if (!month) return;
                
                if (!/^\d{4}-\d{2}$/.test(month)) {
                    Notification.show('月份格式不正确，请输入 YYYY-MM 格式', 'error');
                    return;
                }
                
                const [year, monthNum] = month.split('-').map(Number);
                const daysInMonth = new Date(year, monthNum, 0).getDate();
                const staffData = DataStore.getStaffData();
                
                if (staffData.length === 0) {
                    Notification.show('暂无职工信息，请先添加职工', 'error');
                    return;
                }
                
                let attendanceData = DataStore.getAttendanceData();
                let addedCount = 0;
                
                staffData.forEach(staff => {
                    for (let day = 1; day <= daysInMonth; day++) {
                        const date = `${year}-${String(monthNum).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        
                        // 检查是否已有该职工该日期的记录
                        const exists = attendanceData.some(record =>
                            record.id === staff.id && record.date === date
                        );
                        
                        if (!exists) {
                            // 添加空白记录
                            const newRecord = {
                                id: staff.id,
                                name: staff.name,
                                department: staff.department,
                                status: staff.status,
                                dean: staff.dean,
                                date,
                                time1: '',
                                time2: '',
                                time3: '',
                                time4: '',
                                time5: '',
                                time6: '',
                                time7: '',
                                time8: '',
                                time9: '',
                                time10: '',
                                recordId: DataStore.generateId()
                            };
                            attendanceData.push(newRecord);
                            addedCount++;
                        }
                    }
                });
                
                // 保存数据
                DataStore.saveAttendanceData(attendanceData);
                
                // 重新整理数据
                this.arrangeAttendanceData();
                
                // 刷新页面
                this.renderAttendanceList();
                this.renderArrangedData();
                Notification.show(`成功添加${addedCount}条空白考勤记录`, 'success');
            },
            
            // 渲染考勤列表
            renderAttendanceList() {
                const attendanceData = DataStore.getAttendanceData();
                const searchTerm = document.getElementById('attendance-search').value.toLowerCase().trim();
                const monthFilter = document.getElementById('attendance-month-filter').value;
                const tableBody = document.getElementById('attendance-table-body');
                
                // 筛选数据
                const filteredData = attendanceData.filter(record => {
                    // 月份筛选
                    if (monthFilter && !record.date.startsWith(monthFilter)) {
                        return false;
                    }
                    
                    // 搜索筛选
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm) ||
                            record.dean.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    tableBody.innerHTML = `
                        <tr class="text-center">
                        <td colspan="17" class="px-4 py-8 text-gray-500">暂无匹配的考勤信息</td>
                        </tr>
                    `;
                    return;
                }
                
                // 生成表格内容
                let html = '';
                filteredData.forEach(record => {
                    html += `
                        <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-3 py-2 border-b border-gray-200">${record.id}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.name}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.department}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.status}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.dean}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.date}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time1 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time2 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time3 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time4 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time5 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time6 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time7 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time8 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time9 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time10 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">
                            <button onclick="AttendanceManager.editAttendance('${record.recordId}')" class="text-primary hover:text-primary/80 mr-2 transition-colors text-sm">
                            <i class="fa fa-pencil"></i> 编辑
                            </button>
                            <button onclick="AttendanceManager.deleteAttendance('${record.recordId}')" class="text-danger hover:text-danger/80 transition-colors text-sm">
                            <i class="fa fa-trash"></i> 删除
                            </button>
                        </td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            },
            
            // 渲染整理后的数据
            renderArrangedData() {
                const arrangedData = DataStore.getArrangedData();
                const searchTerm = document.getElementById('arrange-search').value.toLowerCase().trim();
                const monthFilter = document.getElementById('arrange-month-filter').value;
                const tableBody = document.getElementById('arrange-table-body');
                
                // 筛选数据
                const filteredData = arrangedData.filter(record => {
                    // 月份筛选
                    if (monthFilter && !record.date.startsWith(monthFilter)) {
                        return false;
                    }
                    
                    // 搜索筛选
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm) ||
                            record.dean.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    tableBody.innerHTML = `
                        <tr class="text-center">
                        <td colspan="13" class="px-4 py-8 text-gray-500">暂无匹配的整理数据</td>
                        </tr>
                    `;
                    return;
                }

                // 生成表格内容
                let html = '';
                filteredData.forEach(record => {
                    html += `
                        <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-3 py-2 border-b border-gray-200">${record.id}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.name}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.department}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.status}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.dean}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.date}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time1 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time2 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time3 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time4 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200" title="${record.ruleIn}">${record.ruleIn || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200" title="${record.ruleOut}">${record.ruleOut || ''}</td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            },
            
            // 编辑考勤记录
            editAttendance(recordId) {
                const attendanceData = DataStore.getAttendanceData();
                const record = attendanceData.find(r => r.recordId === recordId);
                
                if (record) {
                    document.getElementById('edit-attendance-record-id').value = record.recordId;
                    document.getElementById('edit-attendance-id').value = record.id;
                    document.getElementById('edit-attendance-name').value = record.name;
                    document.getElementById('edit-attendance-department').value = record.department;
                    document.getElementById('edit-attendance-status').value = record.status;
                    document.getElementById('edit-attendance-dean').value = record.dean;
                    document.getElementById('edit-attendance-date').value = record.date;
                    
                    // 填充时间字段
                    for (let i = 1; i <= 10; i++) {
                        const timeValue = record[`time${i}`] || '';
                        document.getElementById(`edit-attendance-time${i}`).value = timeValue;
                    }
                    
                    document.getElementById('edit-attendance-modal').classList.remove('hidden');
                }
            },
            
            // 更新考勤记录
            updateAttendance() {
                const recordId = document.getElementById('edit-attendance-record-id').value;
                const date = document.getElementById('edit-attendance-date').value;
                
                if (!date) {
                    Notification.show('请选择日期', 'error');
                    return;
                }
                
                // 收集时间数据
                const timeData = {};
                for (let i = 1; i <= 10; i++) {
                    timeData[`time${i}`] = document.getElementById(`edit-attendance-time${i}`).value || '';
                }
                
                let attendanceData = DataStore.getAttendanceData();
                const index = attendanceData.findIndex(r => r.recordId === recordId);
                
                if (index !== -1) {
                    attendanceData[index] = {
                        ...attendanceData[index],
                        date,
                        ...timeData
                    };
                    
                    DataStore.saveAttendanceData(attendanceData);
                    
                    // 重新整理数据
                    this.arrangeAttendanceData();
                    
                    // 刷新页面
                    this.renderAttendanceList();
                    this.renderArrangedData();
                    
                    // 刷新分管页面
                    ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                        DeanPage.renderDeanData(dean);
                    });
                    
                    document.getElementById('edit-attendance-modal').classList.add('hidden');
                    Notification.show('考勤信息更新成功', 'success');
                }
            },
            
            // 删除考勤记录
            deleteAttendance(recordId) {
                if (confirm('确定要删除该考勤记录吗？')) {
                    let attendanceData = DataStore.getAttendanceData();
                    attendanceData = attendanceData.filter(r => r.recordId !== recordId);
                    DataStore.saveAttendanceData(attendanceData);
                    
                    // 删除整理后的数据中对应的记录
                    let arrangedData = DataStore.getArrangedData();
                    arrangedData = arrangedData.filter(r => r.recordId !== recordId);
                    DataStore.saveArrangedData(arrangedData);
                    
                    // 刷新页面
                    this.renderAttendanceList();
                    this.renderArrangedData();
                    
                    // 刷新分管页面
                    ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                        DeanPage.renderDeanData(dean);
                    });
                    
                    Notification.show('考勤记录已删除', 'success');
                }
            },
            
            // 根据职工 ID 删除考勤记录
            deleteAttendanceByStaffId(staffId) {
                let attendanceData = DataStore.getAttendanceData();
                attendanceData = attendanceData.filter(r => r.id !== staffId);
                DataStore.saveAttendanceData(attendanceData);
                
                // 删除整理后的数据中对应的记录
                let arrangedData = DataStore.getArrangedData();
                arrangedData = arrangedData.filter(r => r.id !== staffId);
                DataStore.saveArrangedData(arrangedData);
                
                // 刷新页面
                this.renderAttendanceList();
                this.renderArrangedData();
                
                // 刷新分管页面
                ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                    DeanPage.renderDeanData(dean);
                });
            },
            
            // 根据月份删除考勤记录
            deleteAttendanceByMonth() {
                const month = document.getElementById('attendance-month-filter').value;
                if (!month) {
                    Notification.show('请先选择要删除的月份', 'error');
                    return;
                }
                
                if (confirm(`确定要删除${month}月份的所有考勤记录吗？`)) {
                    let attendanceData = DataStore.getAttendanceData();
                    const originalCount = attendanceData.length;
                    attendanceData = attendanceData.filter(r => !r.date.startsWith(month));
                    DataStore.saveAttendanceData(attendanceData);
                    
                    // 删除整理后的数据中对应月份的记录
                    let arrangedData = DataStore.getArrangedData();
                    arrangedData = arrangedData.filter(r => !r.date.startsWith(month));
                    DataStore.saveArrangedData(arrangedData);
                    
                    const deletedCount = originalCount - attendanceData.length;
                    
                    // 刷新页面
                    this.renderAttendanceList();
                    this.renderArrangedData();
                    
                    // 刷新分管页面
                    ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                        DeanPage.renderDeanData(dean);
                    });
                    
                    Notification.show(`成功删除${month}月份${deletedCount}条考勤记录`, 'success');
                }
            },
            
            // 删除整理后的数据中指定月份的记录
            deleteArrangedByMonth() {
                const month = document.getElementById('arrange-month-filter').value;
                if (!month) {
                    Notification.show('请先选择要删除的月份', 'error');
                    return;
                }
                
                if (confirm(`确定要删除${month}月份的所有整理记录吗？考勤原始数据不会被删除`)) {
                    let arrangedData = DataStore.getArrangedData();
                    const originalCount = arrangedData.length;
                    arrangedData = arrangedData.filter(r => !r.date.startsWith(month));
                    DataStore.saveArrangedData(arrangedData);
                    
                    const deletedCount = originalCount - arrangedData.length;
                    
                    // 刷新页面
                    this.renderArrangedData();
                    
                    // 刷新分管页面
                    ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(dean => {
                        DeanPage.renderDeanData(dean);
                    });
                    
                    Notification.show(`成功删除${month}月份${deletedCount}条整理记录`, 'success');
                }
            },
            
            // 更新考勤数据中的职工信息
            updateStaffInfoInAttendance(staffId, name, department, status, dean) {
                let attendanceData = DataStore.getAttendanceData();
                attendanceData = attendanceData.map(record => {
                    if (record.id === staffId) {
                        return {
                            ...record,
                            name,
                            department,
                            status,
                            dean
                        };
                    }
                    return record;
                });
                DataStore.saveAttendanceData(attendanceData);
                
                // 同时更新整理后的数据
                let arrangedData = DataStore.getArrangedData();
                arrangedData = arrangedData.map(record => {
                    if (record.id === staffId) {
                        return {
                            ...record,
                            name,
                            department,
                            status,
                            dean
                        };
                    }
                    return record;
                });
                DataStore.saveArrangedData(arrangedData);
                
                // 刷新页面
                this.renderAttendanceList();
                this.renderArrangedData();
                
                // 刷新分管页面
                ['王雷', '李春娟', '宋增信', '徐伟', '段海燕', '财务'].forEach(deanName => {
                    DeanPage.renderDeanData(deanName);
                });
            },
            
            // 导出考勤 Excel
            exportAttendanceExcel() {
                const attendanceData = DataStore.getAttendanceData();
                const searchTerm = document.getElementById('attendance-search').value.toLowerCase().trim();
                const monthFilter = document.getElementById('attendance-month-filter').value;
                
                // 筛选数据
                const filteredData = attendanceData.filter(record => {
                    if (monthFilter && !record.date.startsWith(monthFilter)) {
                        return false;
                    }
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm) ||
                            record.dean.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    Notification.show('暂无匹配的考勤数据可导出', 'warning');
                    return;
                }
                
                // 准备导出数据
                const exportData = filteredData.map(record => {
                    return {
                        '工号': record.id,
                        '姓名': record.name,
                        '科室': record.department,
                        '状态': record.status,
                        '分管': record.dean,
                        '日期': record.date,
                        '考勤时间 1': record.time1 || '',
                        '考勤时间 2': record.time2 || '',
                        '考勤时间 3': record.time3 || '',
                        '考勤时间 4': record.time4 || '',
                        '考勤时间 5': record.time5 || '',
                        '考勤时间 6': record.time6 || '',
                        '考勤时间 7': record.time7 || '',
                        '考勤时间 8': record.time8 || '',
                        '考勤时间 9': record.time9 || '',
                        '考勤时间 10': record.time10 || ''
                    };
                });
                
                // 创建工作表和工作簿
                const worksheet = XLSX.utils.json_to_sheet(exportData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, '考勤信息');
                
                // 导出文件
                const fileName = `考勤信息表_${monthFilter || new Date().toLocaleDateString()}.xlsx`;
                XLSX.writeFile(workbook, fileName);
                Notification.show('考勤信息导出成功', 'success');
            },
            
            // 导出整理后的数据 Excel
            exportArrangedExcel() {
                const arrangedData = DataStore.getArrangedData();
                const searchTerm = document.getElementById('arrange-search').value.toLowerCase().trim();
                const monthFilter = document.getElementById('arrange-month-filter').value;
                
                // 筛选数据
                const filteredData = arrangedData.filter(record => {
                    if (monthFilter && !record.date.startsWith(monthFilter)) {
                        return false;
                    }
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm) ||
                            record.dean.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    Notification.show('暂无匹配的整理数据可导出', 'warning');
                    return;
                }
                
                // 准备导出数据
                const exportData = filteredData.map(record => {
                    return {
                        '工号': record.id,
                        '姓名': record.name,
                        '科室': record.department,
                        '状态': record.status,
                        '分管': record.dean,
                        '日期': record.date,
                        '考勤时间 1': record.time1 || '',
                        '考勤时间 2': record.time2 || '',
                        '考勤时间 3': record.time3 || '',
                        '考勤时间 4': record.time4 || '',
                        '规则内考勤': record.ruleIn || '',
                        '规则外考勤': record.ruleOut || ''
                    };
                });
                
                // 创建工作表和工作簿
                const worksheet = XLSX.utils.json_to_sheet(exportData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, '整理后考勤信息');
                
                // 导出文件
                const fileName = `整理后考勤信息表_${monthFilter || new Date().toLocaleDateString()}.xlsx`;
                XLSX.writeFile(workbook, fileName);
                Notification.show('整理后考勤信息导出成功', 'success');
            }
        };

        // 分管页面模块
        const DeanPage = {
            // 渲染分管数据
            renderDeanData(deanName) {
                const arrangedData = DataStore.getArrangedData();
                const deanPage = document.getElementById(`dean-${deanName}`);
                const searchInput = deanPage.querySelector('.dean-search');
                const monthFilter = deanPage.querySelector('.dean-month-filter').value;
                const tableBody = deanPage.querySelector('.dean-table-body');
                const searchTerm = searchInput.value.toLowerCase().trim();
                
                // 筛选数据：分管匹配 + 搜索 + 月份
                const filteredData = arrangedData.filter(record => {
                    if (record.dean !== deanName) return false;
                    if (monthFilter && !record.date.startsWith(monthFilter)) return false;
                    
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    tableBody.innerHTML = `
                        <tr class="text-center">
                        <td colspan="11" class="px-4 py-8 text-gray-500">暂无相关考勤数据</td>
                        </tr>
                    `;
                    return;
                }
                
                // 生成表格内容
                let html = '';
                filteredData.forEach(record => {
                    html += `
                        <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-3 py-2 border-b border-gray-200">${record.id}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.name}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.department}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.status}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.date}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time1 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time2 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time3 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200">${record.time4 || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200" title="${record.ruleIn}">${record.ruleIn || ''}</td>
                        <td class="px-3 py-2 border-b border-gray-200" title="${record.ruleOut}">${record.ruleOut || ''}</td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            },
            
            // 导出分管数据 Excel
            exportDeanExcel(deanName) {
                const arrangedData = DataStore.getArrangedData();
                const deanPage = document.getElementById(`dean-${deanName}`);
                const searchInput = deanPage.querySelector('.dean-search');
                const monthFilter = deanPage.querySelector('.dean-month-filter').value;
                const searchTerm = searchInput.value.toLowerCase().trim();
                
                // 筛选数据
                const filteredData = arrangedData.filter(record => {
                    if (record.dean !== deanName) return false;
                    if (monthFilter && !record.date.startsWith(monthFilter)) return false;
                    
                    return record.date.toLowerCase().includes(searchTerm) ||
                            record.id.toLowerCase().includes(searchTerm) ||
                            record.name.toLowerCase().includes(searchTerm) ||
                            record.department.toLowerCase().includes(searchTerm);
                });
                
                if (filteredData.length === 0) {
                    Notification.show('暂无相关考勤数据可导出', 'warning');
                    return;
                }
                
                // 准备导出数据
                const exportData = filteredData.map(record => {
                    return {
                        '工号': record.id,
                        '姓名': record.name,
                        '科室': record.department,
                        '状态': record.status,
                        '日期': record.date,
                        '考勤时间 1': record.time1 || '',
                        '考勤时间 2': record.time2 || '',
                        '考勤时间 3': record.time3 || '',
                        '考勤时间 4': record.time4 || '',
                        '规则内考勤': record.ruleIn || '',
                        '规则外考勤': record.ruleOut || ''
                    };
                });
                
                // 创建工作表和工作簿
                const worksheet = XLSX.utils.json_to_sheet(exportData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, `${deanName}分管考勤`);
                
                // 导出文件
                const fileName = `${deanName}分管考勤表_${monthFilter || new Date().toLocaleDateString()}.xlsx`;
                XLSX.writeFile(workbook, fileName);
                Notification.show(`${deanName}分管考勤表导出成功`, 'success');
            }
        };

        // 全局函数挂载（用于 HTML 中的 onclick 事件）
        window.StaffManager = StaffManager;
        window.AttendanceManager = AttendanceManager;
        window.DeanPage = DeanPage;

        // 初始化系统
        document.addEventListener('DOMContentLoaded', () => {
            PageSwitcher.init();
            StaffManager.init();
            AttendanceManager.init();
        });
        </script>
</body>
</html>


